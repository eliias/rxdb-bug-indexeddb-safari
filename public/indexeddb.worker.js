(()=>{function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(t){var n=function(t,n){if("object"!==e(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var o=r.call(t,n||"default");if("object"!==e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(t)}(t,"string");return"symbol"===e(n)?n:String(n)}function n(e,n){for(var r=0;r<n.length;r++){var o=n[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,t(o.key),o)}}function r(e,t){return r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},r(e,t)}function o(e){return o=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},o(e)}function i(e,t,n){return i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}()?Reflect.construct.bind():function(e,t,n){var o=[null];o.push.apply(o,t);var i=new(Function.bind.apply(e,o));return n&&r(i,n.prototype),i},i.apply(null,arguments)}function s(e){var t="function"==typeof Map?new Map:void 0;return s=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,s)}function s(){return i(e,arguments,o(this).constructor)}return s.prototype=Object.create(e.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),r(s,e)},s(e)}var a={isDevMode:()=>!1,deepFreezeWhenDevMode:e=>e,tunnelErrorMessage:e=>"RxDB Error-Code "+e+".\n        Error messages are not included in RxDB core to reduce build size.\n        - To find out what this error means, either use the dev-mode-plugin https://rxdb.info/dev-mode.html\n        - or search for the error code here: https://github.com/pubkey/rxdb/search?q="+e+"\n        "};function c(e,t,n){return"RxError ("+t+"):\n"+e+"\n"+function(e){var t="";return 0===Object.keys(e).length?t:(t+="Given parameters: {\n",t+=Object.keys(e).map((t=>{var n="[object Object]";try{n="errors"===t?e[t].map((e=>JSON.stringify(e,Object.getOwnPropertyNames(e)))):JSON.stringify(e[t],(function(e,t){return void 0===t?null:t}),2)}catch(e){}return t+":"+n})).join("\n"),t+="}")}(n)}var u=function(e){var t,o,i,s,a;function u(t,n,r={}){var o,i=c(n,t,r);return(o=e.call(this,i)||this).code=t,o.message=i,o.parameters=r,o.rxdb=!0,o}return o=e,(t=u).prototype=Object.create(o.prototype),t.prototype.constructor=t,r(t,o),u.prototype.toString=function(){return this.message},i=u,(s=[{key:"name",get:function(){return"RxError ("+this.code+")"}},{key:"typeError",get:function(){return!1}}])&&n(i.prototype,s),a&&n(i,a),Object.defineProperty(i,"prototype",{writable:!1}),u}(s(Error));function l(e,t){return new u(e,a.tunnelErrorMessage(e),t)}var f=0;function d(){var e=(new Date).getTime();(e+=.01)<=f&&(e=f+.01);var t=parseFloat(e.toFixed(2));return f=t,t}Object.freeze({ignoreUnknown:!1,respectType:!1,respectFunctionNames:!1,respectFunctionProperties:!1,unorderedObjects:!0,unorderedArrays:!1,unorderedSets:!1,excludeKeys:void 0,excludeValues:void 0,replacer:void 0}),Object.freeze(["prototype","__proto__","constructor"]);class h{constructor(e,t){e=this.words=e||[],this.sigBytes=void 0===t?4*e.length:t}toString(e){return(e||p).stringify(this)}concat(e){if(this.clamp(),this.sigBytes%4)for(let t=0;t<e.sigBytes;t++){const n=e.words[t>>>2]>>>24-t%4*8&255;this.words[this.sigBytes+t>>>2]|=n<<24-(this.sigBytes+t)%4*8}else for(let t=0;t<e.sigBytes;t+=4)this.words[this.sigBytes+t>>>2]=e.words[t>>>2];return this.sigBytes+=e.sigBytes,this}clamp(){this.words[this.sigBytes>>>2]&=4294967295<<32-this.sigBytes%4*8,this.words.length=Math.ceil(this.sigBytes/4)}clone(){return new h([...this.words])}}const p={stringify(e){const t=[];for(let n=0;n<e.sigBytes;n++){const r=e.words[n>>>2]>>>24-n%4*8&255;t.push((r>>>4).toString(16),(15&r).toString(16))}return t.join("")}},m={parse(e){const t=e.length,n=[];for(let r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new h(n,t)}},v={parse:e=>m.parse(unescape(encodeURIComponent(e)))};class y{constructor(){this._data=new h,this._nDataBytes=0,this._minBufferSize=0,this.blockSize=16}reset(){this._data=new h,this._nDataBytes=0}_append(e){"string"==typeof e&&(e=v.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes}_doProcessBlock(e,t){}_process(e){let t,n=this._data.sigBytes/(4*this.blockSize);n=e?Math.ceil(n):Math.max((0|n)-this._minBufferSize,0);const r=n*this.blockSize,o=Math.min(4*r,this._data.sigBytes);if(r){for(let e=0;e<r;e+=this.blockSize)this._doProcessBlock(this._data.words,e);t=this._data.words.splice(0,r),this._data.sigBytes-=o}return new h(t,o)}}class b extends y{update(e){return this._append(e),this._process(),this}finalize(e){e&&this._append(e)}}const g=[1779033703,-1150833019,1013904242,-1521486534,1359893119,-1694144372,528734635,1541459225],w=[1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998],_=[];class x extends b{constructor(){super(...arguments),this._hash=new h([...g])}reset(){super.reset(),this._hash=new h([...g])}_doProcessBlock(e,t){const n=this._hash.words;let r=n[0],o=n[1],i=n[2],s=n[3],a=n[4],c=n[5],u=n[6],l=n[7];for(let n=0;n<64;n++){if(n<16)_[n]=0|e[t+n];else{const e=_[n-15],t=(e<<25|e>>>7)^(e<<14|e>>>18)^e>>>3,r=_[n-2],o=(r<<15|r>>>17)^(r<<13|r>>>19)^r>>>10;_[n]=t+_[n-7]+o+_[n-16]}const f=r&o^r&i^o&i,d=(r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22),h=l+((a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25))+(a&c^~a&u)+w[n]+_[n];l=u,u=c,c=a,a=s+h|0,s=i,i=o,o=r,r=h+(d+f)|0}n[0]=n[0]+r|0,n[1]=n[1]+o|0,n[2]=n[2]+i|0,n[3]=n[3]+s|0,n[4]=n[4]+a|0,n[5]=n[5]+c|0,n[6]=n[6]+u|0,n[7]=n[7]+l|0}finalize(e){super.finalize(e);const t=8*this._nDataBytes,n=8*this._data.sigBytes;return this._data.words[n>>>5]|=128<<24-n%32,this._data.words[14+(n+64>>>9<<4)]=Math.floor(t/4294967296),this._data.words[15+(n+64>>>9<<4)]=t,this._data.sigBytes=4*this._data.words.length,this._process(),this._hash}}function S(e){return t=e,(new x).finalize(t).toString();var t}function E(e){if(!e)throw new Error("ensureNotFalsy() is falsy");return e}function O(e){var t=e.split("."),n=t.length;return 1===n?t=>t[e]:e=>{for(var r=e,o=0;o<n;++o)if(void 0===(r=r[t[o]]))return r;return r}}function I(e){return Object.assign({},e)}function P(e,t,n,r,o){for(var i,s=!!e.schema.attachments,a=[],c=[],u={},f=new Map,h=function(e=10){for(var t="",n="abcdefghijklmnopqrstuvwxyz",r=0;r<e;r++)t+=n.charAt(Math.floor(26*Math.random()));return t}(10),p={id:h,events:[],checkpoint:null,context:o},m=[],v=[],y=[],b=d(),g="function"==typeof n.get,w=g?n.size>0:Object.keys(n).length>0,_=r.length,x=function(){var e,o=r[O],_=o.document[t],x=!1;if(w&&(x=g?n.get(_):n[_]),x){var I=x._rev;if(!o.previous||o.previous&&I!==o.previous._rev){var P={isError:!0,status:409,documentId:_,writeRow:o,documentInDb:x};return u[_]=P,1}var A=s?k(o):o;s&&(o.document._deleted?o.previous&&Object.keys(o.previous._attachments).forEach((e=>{v.push({documentId:_,attachmentId:e,digest:E(o.previous)._attachments[e].digest})})):(Object.entries(o.document._attachments).find((([t,n])=>((o.previous?o.previous._attachments[t]:void 0)||n.data||(e={documentId:_,documentInDb:x,isError:!0,status:510,writeRow:o,attachmentId:t}),!0))),e||Object.entries(o.document._attachments).forEach((([e,t])=>{var n=o.previous?o.previous._attachments[e]:void 0;if(n){var r=A.document._attachments[e].digest;t.data&&n.digest!==r&&y.push({documentId:_,attachmentId:e,attachmentData:t,digest:S(t.data)})}else m.push({documentId:_,attachmentId:e,attachmentData:t,digest:S(t.data)})})))),e?u[_]=e:(c.push(A),(!i||i.document._meta.lwt<A.document._meta.lwt)&&(i=A));var $=o.document,C=null,L=null,D=null;if(o.previous&&o.previous._deleted&&!$._deleted)D="INSERT",C=s?j($):$;else if(!o.previous||o.previous._deleted||$._deleted){if(!$._deleted)throw l("SNH",{args:{writeRow:o}});D="DELETE",C=E(o.document),L=o.previous}else D="UPDATE",C=s?j($):$,L=o.previous;var B={eventId:N(h,O,_,o),documentId:_,documentData:C,previousDocumentData:L,operation:D,startTime:b,endTime:d()};f.set(_,B),p.events.push(B)}else{var M=!!o.document._deleted;if(s&&Object.entries(o.document._attachments).forEach((([t,n])=>{n.data?m.push({documentId:_,attachmentId:t,attachmentData:n,digest:S(n.data)}):(e={documentId:_,isError:!0,status:510,writeRow:o,attachmentId:t},u[_]=e)})),e||(s?a.push(k(o)):a.push(o),(!i||i.document._meta.lwt<o.document._meta.lwt)&&(i=o)),!M){var T={eventId:N(h,O,_,o),documentId:_,operation:"INSERT",documentData:s?j(o.document):o.document,previousDocumentData:s&&o.previous?j(o.previous):o.previous,startTime:b,endTime:d()};f.set(_,T),p.events.push(T)}}},O=0;O<_;O++)x();return{bulkInsertDocs:a,bulkUpdateDocs:c,newestRow:i,errors:u,changeByDocId:f,eventBulk:p,attachmentsAdd:m,attachmentsRemove:v,attachmentsUpdate:y}}function k(e){return{previous:e.previous,document:j(e.document)}}function j(e){var t=I(e);return t._attachments={},Object.entries(e._attachments).forEach((([e,n])=>{var r,o,i;t._attachments[e]=(i=(r=n).data)?{digest:S(i),length:(o=i,atob(o).length),type:r.type}:r})),t}function N(e,t,n,r){return e+"|"+t+"|"+n+"|"+r.document._rev}function A(e){return e[e.length-1]}function $(e,t){var n=0,r=-1;for(var o of e){if(!t(o,r+=1))break;n+=1}return n}var C=/\./g,L=e=>{var t=typeof e;return null!==e&&("object"===t||"function"===t)},D=new Set(["__proto__","prototype","constructor"]),B=new Set("0123456789");function M(e){var t=[],n="",r="start",o=!1;for(var i of e)switch(i){case"\\":if("index"===r)throw new Error("Invalid character in an index");if("indexEnd"===r)throw new Error("Invalid character after an index");o&&(n+=i),r="property",o=!o;break;case".":if("index"===r)throw new Error("Invalid character in an index");if("indexEnd"===r){r="property";break}if(o){o=!1,n+=i;break}if(D.has(n))return[];t.push(n),n="",r="property";break;case"[":if("index"===r)throw new Error("Invalid character in an index");if("indexEnd"===r){r="index";break}if(o){o=!1,n+=i;break}if("property"===r){if(D.has(n))return[];t.push(n),n=""}r="index";break;case"]":if("index"===r){t.push(Number.parseInt(n,10)),n="",r="indexEnd";break}if("indexEnd"===r)throw new Error("Invalid character after an index");default:if("index"===r&&!B.has(i))throw new Error("Invalid character in an index");if("indexEnd"===r)throw new Error("Invalid character after an index");"start"===r&&(r="property"),o&&(o=!1,n+="\\"),n+=i}switch(o&&(n+="\\"),r){case"property":if(D.has(n))return[];t.push(n);break;case"index":throw new Error("Index was not closed");case"start":t.push("")}return t}function T(e,t){if("number"!=typeof t&&Array.isArray(e)){var n=Number.parseInt(t,10);return Number.isInteger(n)&&e[n]===e[t]}return!1}function R(e,t){var n=function(e,t,n){if(Array.isArray(t)&&(t=t.join(".")),!L(e)||"string"!=typeof t)return void 0===n?e:n;var r=M(t);if(0===r.length)return n;for(var o=0;o<r.length;o++){var i=r[o];if(null==(e=T(e,i)?o===r.length-1?void 0:null:e[i])){if(o!==r.length-1)return n;break}}return void 0===e?n:e}(e,function(e){for(;"."===e.charAt(0);)e=e.substr(1);for(;"."===e.slice(-1);)e=e.slice(0,-1);return e}("properties."+t.replace(C,".properties.")));return n}function K(e){return"string"==typeof e?e:e.key}var F=String.fromCharCode(65535),U=Number.MIN_VALUE;function z(e,t){var n=K(e.primaryKey),r=t.selector,o=e.indexes?e.indexes.slice(0):[];t.index?o=[t.index]:o.push([n]);var i,s=t.sort.map((e=>Object.keys(e)[0])).join(","),a=!!t.sort.find((e=>"desc"===Object.values(e)[0])),c=-1;return o.forEach((e=>{var n=!0,o=!0,u=e.map((e=>{var t=r[e],i=t?Object.keys(t):[],s={};return t&&i.length?i.forEach((e=>{if(q.has(e)){var n=function(e,t){switch(e){case"$eq":return{startKey:t,endKey:t};case"$lte":return{endKey:t};case"$gte":return{startKey:t};case"$lt":return{endKey:t,inclusiveEnd:!1};case"$gt":return{startKey:t,inclusiveStart:!1};default:throw new Error("SNH")}}(e,t[e]);s=Object.assign(s,n)}})):s={startKey:o?U:F,endKey:n?F:U,inclusiveStart:!0,inclusiveEnd:!0},void 0===s.startKey&&(s.startKey=U),void 0===s.endKey&&(s.endKey=F),void 0===s.inclusiveStart&&(s.inclusiveStart=!0),void 0===s.inclusiveEnd&&(s.inclusiveEnd=!0),o&&!s.inclusiveStart&&(o=!1),n&&!s.inclusiveEnd&&(n=!1),s})),l={index:e,startKeys:u.map((e=>e.startKey)),endKeys:u.map((e=>e.endKey)),inclusiveEnd:n,inclusiveStart:o,sortFieldsSameAsIndexFields:!a&&s===e.join(","),selectorSatisfiedByIndex:V(e,t.selector)},f=function(e,t,n){var r=0,o=e=>{e>0&&(r+=e)},i=10,s=$(n.startKeys,(e=>e!==U&&e!==F));o(s*i);var a=$(n.startKeys,(e=>e!==F&&e!==U));o(a*i);var c=$(n.startKeys,((e,t)=>e===n.endKeys[t]));return o(c*i*1.5),o(n.sortFieldsSameAsIndexFields?5:0),r}(0,0,l);(f>0&&f>c||t.index)&&(c=f,i=l)})),i||(i={index:[n],startKeys:[U],endKeys:[F],inclusiveEnd:!0,inclusiveStart:!0,sortFieldsSameAsIndexFields:!a&&s===n,selectorSatisfiedByIndex:V([n],t.selector)}),i}var q=new Set(["$eq","$gt","$gte","$lt","$lte"]),W=new Set(["$eq","$gt","$gte"]),Q=new Set(["$eq","$lt","$lte"]);function V(e,t){var n,r;return!Object.entries(t).find((([t,n])=>!e.includes(t)||Object.entries(n).find((([e,t])=>!q.has(e)))))&&!e.find((e=>{var r=t[e];if(!r)return!1;var o=Object.keys(r).find((e=>W.has(e)));return!(!n||!o)||("$eq"!==o&&(n=o),!1)}))&&!e.find((e=>{var n=t[e];if(!n)return!1;var o=Object.keys(n).find((e=>Q.has(e)));return!(!r||!o)||("$eq"!==o&&(r=o),!1)}))}var J={prepareQuery(e,t){if(!t.sort)throw l("SNH",{query:t});return{query:t,queryPlan:z(e,t)}},checkpointSchema:{type:"object",properties:{id:{type:"string"},lwt:{type:"number"}},required:["id","lwt"],additionalProperties:!1}};function G(e=0){return new Promise((t=>setTimeout(t,e)))}Promise.resolve(!0),Promise.resolve(!1),Promise.resolve(null);var H=Promise.resolve();function Y(e,t){var n=e.get(t);if(void 0===n)throw new Error("missing value from map "+t);return n}function X(e,t){var n=t.map((t=>{var n=R(e,t);if(!n)throw new Error("not in schema: "+t);var r,o=n.type;"number"!==o&&"integer"!==o||(r=Z(n));var i,s=O(t),a=n.maxLength?n.maxLength:0;return i="string"===o?e=>{var t=s(e);return t||(t=""),t.padEnd(a," ")}:"boolean"===o?e=>s(e)?"1":"0":e=>{var t=s(e);return ee(r,t)},{fieldName:t,schemaPart:n,parsedLengths:r,getValue:s,getIndexStringPart:i}}));return n}function Z(e){var t=Math.floor(e.minimum),n=Math.ceil(e.maximum),r=e.multipleOf,o=(n-t).toString().length,i=r.toString().split("."),s=0;return i.length>1&&(s=i[1].length),{minimum:t,maximum:n,nonDecimals:o,decimals:s,roundedMinimum:t}}function ee(e,t){void 0===t&&(t=0),t<e.minimum&&(t=e.minimum),t>e.maximum&&(t=e.maximum);var n=(Math.floor(t)-e.roundedMinimum).toString().padStart(e.nonDecimals,"0");if(e.decimals>0){var r=t.toString().split(".");n+=(r.length>1?r[1]:"0").padEnd(e.decimals,"0")}return n}function te(e,t,n,r){var o="";return t.forEach(((t,i)=>{var s=R(e,t),a=n[i],c=s.type;switch(c){case"string":var u=E(s.maxLength);o+="string"==typeof a?a.padEnd(u," "):"".padEnd(u," ");break;case"boolean":o+=null===a?r?"0":F:a?"1":"0";break;case"number":case"integer":var l=Z(s);o+=null===a||a===U?(r?"0":F).repeat(l.nonDecimals+l.decimals):ee(l,a);break;default:throw new Error("unknown index type "+c)}})),o}function ne(e,t,n,r){var o="";return t.forEach(((t,i)=>{var s=R(e,t),a=n[i],c=s.type;switch(c){case"string":var u=E(s.maxLength);o+="string"==typeof a&&a!==F?a.padEnd(u," "):"".padEnd(u,r?F:" ");break;case"boolean":o+=null===a?r?"0":"1":a?"1":"0";break;case"number":case"integer":var l=Z(s);o+=null===a||a===F?(r?"9":"0").repeat(l.nonDecimals+l.decimals):ee(l,a);break;default:throw new Error("unknown index type "+c)}})),o}function re(e){return e.join("||")}function oe(e,t){var n=re(t);return Y(e.indexIdByName,n)}var ie={locale:null,unique:!1};function se(e,t,n){var r={i:t,d:n};return function(e,t,n){for(var r=e.indexIds,o=0;o<r.length;++o){var i=r[o],s=(0,e.getIndexableStringByIndexId[i])(t);n[i]=s}}(e,n,r),r}var ae=["_deleted","_meta.lwt"];function ce(e){var t=K(e.primaryKey),n={},r=e.indexes?e.indexes.map((e=>Array.isArray(e)?e.slice(0):[e])):[];r.push([t]);var o=["_meta.lwt",t];(r=r.map((e=>["_deleted"].concat(e)))).push(o),r.push(ae);var i=new Map;return r.forEach(((t,r)=>{var o="i"+r,s=re(t);i.set(s,o),n[o]=function(e,t){var n=X(e,t),r=n.length,o=n.map((e=>e.getIndexStringPart));return function(e){for(var t="",n=0;n<r;++n)t+=o[n](e);return t}}(e,t)})),{indexIdByName:i,monadByIndexId:n}}re(ae);var ue="documents",le="attachments",fe={durability:"relaxed"},de="indexeddb",he=J,pe=0;function me(e,t){return e+"||"+t}var ve=new Map;function ye(e,t){var n=ve.get(e);return n||(n=H),n=E(n).then((()=>t())),ve.set(e,n),n}function be(e,t){t.onversionchange=n=>{e.closed||(t.close(),e.creationPromise=e.refreshIDBDatabase())}}function ge(e,t,n,r){var o=e.indexedDBStates.get(n);return o||(o=function(e,t,n){var r=pe++,o=n.indexedDB,i=async()=>(await G(0),ye(e,(()=>new Promise(((t,n)=>{var i=o.open(e);i.onerror=function(t){console.error(r+": OPEN IDB DATABASE "+e+" ERROR"),n(t)},i.onsuccess=function(e){var n=i.result;t(n),be(s,n)},_e(s,i)}))))),s={debugId:r,closed:!1,storage:t,settings:n,refreshIDBDatabase:i,creationPromise:i(),name:e,refCount:0,storesToOpen:[]};return s}(n,e,t),e.indexedDBStates.set(n,o)),o.storesToOpen=o.storesToOpen.concat(r),o.refCount=o.refCount+1,o.creationPromise.then((()=>async function(e){var t=e.settings.indexedDB;if(0!==e.storesToOpen.length)return e.creationPromise=e.creationPromise.then((async n=>{var r=new Set(Array.from(n.objectStoreNames));if(0===e.storesToOpen.filter((e=>!r.has(we(e.collectionName,e.schema).documentStore))).length)return n;var o=n.version+1;return n.close(),ye(e.name,(()=>new Promise((async(n,r)=>{var i=t.open(e.name,o);i.onerror=function(t){console.error(e.debugId+": ERROR openStoresOnExistingDatabase() openRequest: error "),r(t)},i.onsuccess=function(t){var r=i.result;be(e,r),n(r)},i.onblocked=e=>{},_e(e,i)}))))})),e.creationPromise}(E(o)))).then((()=>E(o)))}function we(e,t){var n=t.version;return{documentStore:e+"-"+n+"-"+ue,attachmentsStore:e+"-"+n+"-"+le}}function _e(e,t){t.onupgradeneeded=function(n){var r=t.result;e.storesToOpen.forEach((e=>{var t=r.objectStoreNames,n=we(e.collectionName,e.schema);t.contains(n.documentStore)||(function(e,t){t.indexIds.forEach((t=>{e.createIndex(t,t,ie)}))}(r.createObjectStore(n.documentStore,{keyPath:"i",autoIncrement:!1}),e),e.schema.attachments&&r.createObjectStore(n.attachmentsStore,{keyPath:"docIdWithAttachmentId",autoIncrement:!1}))})),e.storesToOpen=[]}}var xe=function(e,t){return xe=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},xe(e,t)};function Se(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}xe(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function Ee(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))}function Oe(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){s.label=a[1];break}if(6===a[0]&&s.label<o[1]){s.label=o[1],o=a;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(a);break}o[2]&&s.ops.pop(),s.trys.pop();continue}a=t.call(e,s)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}}function Ie(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Pe(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)s.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return s}function ke(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}function je(e){return this instanceof je?(this.v=e,this):new je(e)}function Ne(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,o=n.apply(e,t||[]),i=[];return r={},s("next"),s("throw"),s("return"),r[Symbol.asyncIterator]=function(){return this},r;function s(e){o[e]&&(r[e]=function(t){return new Promise((function(n,r){i.push([e,t,n,r])>1||a(e,t)}))})}function a(e,t){try{(n=o[e](t)).value instanceof je?Promise.resolve(n.value.v).then(c,u):l(i[0][2],n)}catch(e){l(i[0][3],e)}var n}function c(e){a("next",e)}function u(e){a("throw",e)}function l(e,t){e(t),i.shift(),i.length&&a(i[0][0],i[0][1])}}function Ae(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=Ie(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,o){!function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)}(r,o,(t=e[n](t)).done,t.value)}))}}}function $e(e){return"function"==typeof e}function Ce(e){var t=e((function(e){Error.call(e),e.stack=(new Error).stack}));return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;var Le=Ce((function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}}));function De(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}}var Be=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}var t;return e.prototype.unsubscribe=function(){var e,t,n,r,o;if(!this.closed){this.closed=!0;var i=this._parentage;if(i)if(this._parentage=null,Array.isArray(i))try{for(var s=Ie(i),a=s.next();!a.done;a=s.next())a.value.remove(this)}catch(t){e={error:t}}finally{try{a&&!a.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}else i.remove(this);var c=this.initialTeardown;if($e(c))try{c()}catch(e){o=e instanceof Le?e.errors:[e]}var u=this._finalizers;if(u){this._finalizers=null;try{for(var l=Ie(u),f=l.next();!f.done;f=l.next()){var d=f.value;try{Re(d)}catch(e){o=null!=o?o:[],e instanceof Le?o=ke(ke([],Pe(o)),Pe(e.errors)):o.push(e)}}}catch(e){n={error:e}}finally{try{f&&!f.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}}if(o)throw new Le(o)}},e.prototype.add=function(t){var n;if(t&&t!==this)if(this.closed)Re(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&De(t,e)},e.prototype.remove=function(t){var n=this._finalizers;n&&De(n,t),t instanceof e&&t._removeParent(this)},e.EMPTY=((t=new e).closed=!0,t),e}(),Me=Be.EMPTY;function Te(e){return e instanceof Be||e&&"closed"in e&&$e(e.remove)&&$e(e.add)&&$e(e.unsubscribe)}function Re(e){$e(e)?e():e.unsubscribe()}var Ke={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Fe={setTimeout:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var o=Fe.delegate;return(null==o?void 0:o.setTimeout)?o.setTimeout.apply(o,ke([e,t],Pe(n))):setTimeout.apply(void 0,ke([e,t],Pe(n)))},clearTimeout:function(e){var t=Fe.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function Ue(e){Fe.setTimeout((function(){var t=Ke.onUnhandledError;if(!t)throw e;t(e)}))}function ze(){}var qe=We("C",void 0,void 0);function We(e,t,n){return{kind:e,value:t,error:n}}var Qe=null;function Ve(e){if(Ke.useDeprecatedSynchronousErrorHandling){var t=!Qe;if(t&&(Qe={errorThrown:!1,error:null}),e(),t){var n=Qe,r=n.errorThrown,o=n.error;if(Qe=null,r)throw o}}else e()}var Je=function(e){function t(t){var n=e.call(this)||this;return n.isStopped=!1,t?(n.destination=t,Te(t)&&t.add(n)):n.destination=tt,n}return Se(t,e),t.create=function(e,t,n){return new Xe(e,t,n)},t.prototype.next=function(e){this.isStopped?et(function(e){return We("N",e,void 0)}(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?et(We("E",void 0,e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?et(qe,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(Be),Ge=Function.prototype.bind;function He(e,t){return Ge.call(e,t)}var Ye=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){Ze(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){Ze(e)}else Ze(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){Ze(e)}},e}(),Xe=function(e){function t(t,n,r){var o,i,s=e.call(this)||this;return $e(t)||!t?o={next:null!=t?t:void 0,error:null!=n?n:void 0,complete:null!=r?r:void 0}:s&&Ke.useDeprecatedNextContext?((i=Object.create(t)).unsubscribe=function(){return s.unsubscribe()},o={next:t.next&&He(t.next,i),error:t.error&&He(t.error,i),complete:t.complete&&He(t.complete,i)}):o=t,s.destination=new Ye(o),s}return Se(t,e),t}(Je);function Ze(e){var t;Ke.useDeprecatedSynchronousErrorHandling?(t=e,Ke.useDeprecatedSynchronousErrorHandling&&Qe&&(Qe.errorThrown=!0,Qe.error=t)):Ue(e)}function et(e,t){var n=Ke.onStoppedNotification;n&&Fe.setTimeout((function(){return n(e,t)}))}var tt={closed:!0,next:ze,error:function(e){throw e},complete:ze},nt="function"==typeof Symbol&&Symbol.observable||"@@observable";function rt(e){return e}function ot(e){return 0===e.length?rt:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}var it=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r,o=this,i=(r=e)&&r instanceof Je||function(e){return e&&$e(e.next)&&$e(e.error)&&$e(e.complete)}(r)&&Te(r)?e:new Xe(e,t,n);return Ve((function(){var e=o,t=e.operator,n=e.source;i.add(t?t.call(i,n):n?o._subscribe(i):o._trySubscribe(i))})),i},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=st(t))((function(t,r){var o=new Xe({next:function(t){try{e(t)}catch(e){r(e),o.unsubscribe()}},error:r,complete:t});n.subscribe(o)}))},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[nt]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return ot(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=st(e))((function(e,n){var r;t.subscribe((function(e){return r=e}),(function(e){return n(e)}),(function(){return e(r)}))}))},e.create=function(t){return new e(t)},e}();function st(e){var t;return null!==(t=null!=e?e:Ke.Promise)&&void 0!==t?t:Promise}var at=Ce((function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),ct=function(e){function t(){var t=e.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return Se(t,e),t.prototype.lift=function(e){var t=new ut(this,this);return t.operator=e,t},t.prototype._throwIfClosed=function(){if(this.closed)throw new at},t.prototype.next=function(e){var t=this;Ve((function(){var n,r;if(t._throwIfClosed(),!t.isStopped){t.currentObservers||(t.currentObservers=Array.from(t.observers));try{for(var o=Ie(t.currentObservers),i=o.next();!i.done;i=o.next())i.value.next(e)}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}}}))},t.prototype.error=function(e){var t=this;Ve((function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var n=t.observers;n.length;)n.shift().error(e)}}))},t.prototype.complete=function(){var e=this;Ve((function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}}))},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var t=this,n=this,r=n.hasError,o=n.isStopped,i=n.observers;return r||o?Me:(this.currentObservers=null,i.push(e),new Be((function(){t.currentObservers=null,De(i,e)})))},t.prototype._checkFinalizedStatuses=function(e){var t=this,n=t.hasError,r=t.thrownError,o=t.isStopped;n?e.error(r):o&&e.complete()},t.prototype.asObservable=function(){var e=new it;return e.source=this,e},t.create=function(e,t){return new ut(e,t)},t}(it),ut=function(e){function t(t,n){var r=e.call(this)||this;return r.destination=t,r.source=n,r}return Se(t,e),t.prototype.next=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===n||n.call(t,e)},t.prototype.error=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===n||n.call(t,e)},t.prototype.complete=function(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)},t.prototype._subscribe=function(e){var t,n;return null!==(n=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==n?n:Me},t}(ct);function lt(e){return function(t){if(function(e){return $e(null==e?void 0:e.lift)}(t))return t.lift((function(t){try{return e(t,this)}catch(e){this.error(e)}}));throw new TypeError("Unable to lift unknown Observable type")}}var ft=Array.isArray;function dt(e,t,n,r,o){return new ht(e,t,n,r,o)}var ht=function(e){function t(t,n,r,o,i,s){var a=e.call(this,t)||this;return a.onFinalize=i,a.shouldUnsubscribe=s,a._next=n?function(e){try{n(e)}catch(e){t.error(e)}}:e.prototype._next,a._error=o?function(e){try{o(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,a._complete=r?function(){try{r()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,a}return Se(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;e.prototype.unsubscribe.call(this),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},t}(Je),pt=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function mt(e){return $e(null==e?void 0:e.then)}function vt(e){return $e(e[nt])}function yt(e){return Symbol.asyncIterator&&$e(null==e?void 0:e[Symbol.asyncIterator])}function bt(e){return new TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var gt="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function wt(e){return $e(null==e?void 0:e[gt])}function _t(e){return Ne(this,arguments,(function(){var t,n,r;return Oe(this,(function(o){switch(o.label){case 0:t=e.getReader(),o.label=1;case 1:o.trys.push([1,,9,10]),o.label=2;case 2:return[4,je(t.read())];case 3:return n=o.sent(),r=n.value,n.done?[4,je(void 0)]:[3,5];case 4:return[2,o.sent()];case 5:return[4,je(r)];case 6:return[4,o.sent()];case 7:return o.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}}))}))}function xt(e){return $e(null==e?void 0:e.getReader)}function St(e){if(e instanceof it)return e;if(null!=e){if(vt(e))return o=e,new it((function(e){var t=o[nt]();if($e(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")}));if(pt(e))return r=e,new it((function(e){for(var t=0;t<r.length&&!e.closed;t++)e.next(r[t]);e.complete()}));if(mt(e))return n=e,new it((function(e){n.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,Ue)}));if(yt(e))return Et(e);if(wt(e))return t=e,new it((function(e){var n,r;try{for(var o=Ie(t),i=o.next();!i.done;i=o.next()){var s=i.value;if(e.next(s),e.closed)return}}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}e.complete()}));if(xt(e))return Et(_t(e))}var t,n,r,o;throw bt(e)}function Et(e){return new it((function(t){(function(e,t){var n,r,o,i;return Ee(this,void 0,void 0,(function(){var s,a;return Oe(this,(function(c){switch(c.label){case 0:c.trys.push([0,5,6,11]),n=Ae(e),c.label=1;case 1:return[4,n.next()];case 2:if((r=c.sent()).done)return[3,4];if(s=r.value,t.next(s),t.closed)return[2];c.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return a=c.sent(),o={error:a},[3,11];case 6:return c.trys.push([6,,9,10]),r&&!r.done&&(i=n.return)?[4,i.call(n)]:[3,8];case 7:c.sent(),c.label=8;case 8:return[3,10];case 9:if(o)throw o.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}}))}))})(e,t).catch((function(e){return t.error(e)}))}))}function Ot(e,t,n,r,o){void 0===r&&(r=0),void 0===o&&(o=!1);var i=t.schedule((function(){n(),o?e.add(this.schedule(null,r)):this.unsubscribe()}),r);if(e.add(i),!o)return i}function It(e,t,n){return void 0===n&&(n=1/0),$e(t)?It((function(n,r){return function(e,t){return lt((function(n,r){var o=0;n.subscribe(dt(r,(function(n){r.next(e.call(t,n,o++))})))}))}((function(e,o){return t(n,e,r,o)}))(St(e(n,r)))}),n):("number"==typeof t&&(n=t),lt((function(t,r){return function(e,t,n,r,o,i,s,a){var c=[],u=0,l=0,f=!1,d=function(){!f||c.length||u||t.complete()},h=function(e){return u<r?p(e):c.push(e)},p=function(e){i&&t.next(e),u++;var a=!1;St(n(e,l++)).subscribe(dt(t,(function(e){null==o||o(e),i?h(e):t.next(e)}),(function(){a=!0}),void 0,(function(){if(a)try{u--;for(var e=function(){var e=c.shift();s?Ot(t,s,(function(){return p(e)})):p(e)};c.length&&u<r;)e();d()}catch(e){t.error(e)}})))};return e.subscribe(dt(t,h,(function(){f=!0,d()}))),function(){null==a||a()}}(t,r,e,n)})))}function Pt(e){return e[e.length-1]}function kt(e){return(t=Pt(e))&&$e(t.schedule)?e.pop():void 0;var t}function jt(e,t){return void 0===t&&(t=0),lt((function(n,r){n.subscribe(dt(r,(function(n){return Ot(r,e,(function(){return r.next(n)}),t)}),(function(){return Ot(r,e,(function(){return r.complete()}),t)}),(function(n){return Ot(r,e,(function(){return r.error(n)}),t)})))}))}function Nt(e,t){return void 0===t&&(t=0),lt((function(n,r){r.add(e.schedule((function(){return n.subscribe(r)}),t))}))}function At(e,t){if(!e)throw new Error("Iterable cannot be null");return new it((function(n){Ot(n,t,(function(){var r=e[Symbol.asyncIterator]();Ot(n,t,(function(){r.next().then((function(e){e.done?n.complete():n.next(e.value)}))}),0,!0)}))}))}function $t(e,t){if(null!=e){if(vt(e))return function(e,t){return St(e).pipe(Nt(t),jt(t))}(e,t);if(pt(e))return function(e,t){return new it((function(n){var r=0;return t.schedule((function(){r===e.length?n.complete():(n.next(e[r++]),n.closed||this.schedule())}))}))}(e,t);if(mt(e))return function(e,t){return St(e).pipe(Nt(t),jt(t))}(e,t);if(yt(e))return At(e,t);if(wt(e))return function(e,t){return new it((function(n){var r;return Ot(n,t,(function(){r=e[gt](),Ot(n,t,(function(){var e,t,o;try{t=(e=r.next()).value,o=e.done}catch(e){return void n.error(e)}o?n.complete():n.next(t)}),0,!0)})),function(){return $e(null==r?void 0:r.return)&&r.return()}}))}(e,t);if(xt(e))return function(e,t){return At(_t(e),t)}(e,t)}throw bt(e)}function Ct(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=kt(e),r=function(e,t){return"number"==typeof Pt(e)?e.pop():t}(e,1/0);return e=function(e){return 1===e.length&&ft(e[0])?e[0]:e}(e),lt((function(t,o){(function(e){return void 0===e&&(e=1/0),It(rt,e)})(r)(function(e,t){return t?$t(e,t):St(e)}(ke([t],Pe(e)),n)).subscribe(o)}))}Promise.resolve(!1);var Lt=Promise.resolve(!0),Dt=Promise.resolve();function Bt(e,t){return e||(e=0),new Promise((function(n){return setTimeout((function(){return n(t)}),e)}))}function Mt(){return Math.random().toString(36).substring(2)}var Tt=0,Rt=0;function Kt(){var e=(new Date).getTime();return e===Tt?1e3*e+ ++Rt:(Tt=e,Rt=0,1e3*e)}var Ft={create:function(e){var t={messagesCallback:null,bc:new BroadcastChannel(e),subFns:[]};return t.bc.onmessage=function(e){t.messagesCallback&&t.messagesCallback(e.data)},t},close:function(e){e.bc.close(),e.subFns=[]},onMessage:function(e,t){e.messagesCallback=t},postMessage:function(e,t){try{return e.bc.postMessage(t,!1),Dt}catch(e){return Promise.reject(e)}},canBeUsed:function(){if("undefined"==typeof window&&"undefined"==typeof self||"function"!=typeof BroadcastChannel)return!1;if(BroadcastChannel._pubkey)throw new Error("BroadcastChannel: Do not overwrite window.BroadcastChannel with this module, this is not a polyfill");return!0},type:"native",averageResponseTime:function(){return 150},microSeconds:Kt},Ut=function(){function e(e){this.ttl=e,this.map=new Map,this._to=!1}return e.prototype.has=function(e){return this.map.has(e)},e.prototype.add=function(e){var t=this;this.map.set(e,zt()),this._to||(this._to=!0,setTimeout((function(){t._to=!1,function(e){for(var t=zt()-e.ttl,n=e.map[Symbol.iterator]();;){var r=n.next().value;if(!r)return;var o=r[0];if(!(r[1]<t))return;e.map.delete(o)}}(t)}),0))},e.prototype.clear=function(){this.map.clear()},e}();function zt(){return(new Date).getTime()}function qt(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=JSON.parse(JSON.stringify(e));return void 0===t.webWorkerSupport&&(t.webWorkerSupport=!0),t.idb||(t.idb={}),t.idb.ttl||(t.idb.ttl=45e3),t.idb.fallbackInterval||(t.idb.fallbackInterval=150),e.idb&&"function"==typeof e.idb.onclose&&(t.idb.onclose=e.idb.onclose),t.localstorage||(t.localstorage={}),t.localstorage.removeTimeout||(t.localstorage.removeTimeout=6e4),e.methods&&(t.methods=e.methods),t.node||(t.node={}),t.node.ttl||(t.node.ttl=12e4),t.node.maxParallelWrites||(t.node.maxParallelWrites=2048),void 0===t.node.useFastPath&&(t.node.useFastPath=!0),t}var Wt="pubkey.broadcast-channel-0-",Qt="messages",Vt={durability:"relaxed"};function Jt(){if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof window){if(void 0!==window.mozIndexedDB)return window.mozIndexedDB;if(void 0!==window.webkitIndexedDB)return window.webkitIndexedDB;if(void 0!==window.msIndexedDB)return window.msIndexedDB}return!1}function Gt(e){e.commit&&e.commit()}function Ht(e,t){var n=e.transaction(Qt,"readonly",Vt),r=n.objectStore(Qt),o=[],i=IDBKeyRange.bound(t+1,1/0);if(r.getAll){var s=r.getAll(i);return new Promise((function(e,t){s.onerror=function(e){return t(e)},s.onsuccess=function(t){e(t.target.result)}}))}return new Promise((function(e,s){var a=function(){try{return i=IDBKeyRange.bound(t+1,1/0),r.openCursor(i)}catch(e){return r.openCursor()}}();a.onerror=function(e){return s(e)},a.onsuccess=function(r){var i=r.target.result;i?i.value.id<t+1?i.continue(t+1):(o.push(i.value),i.continue()):(Gt(n),e(o))}}))}function Yt(e){return(t=e.db,n=e.options.idb.ttl,r=(new Date).getTime()-n,o=t.transaction(Qt,"readonly",Vt),i=o.objectStore(Qt),s=[],new Promise((function(e){i.openCursor().onsuccess=function(t){var n=t.target.result;if(n){var i=n.value;i.time<r?(s.push(i),n.continue()):(Gt(o),e(s))}else e(s)}}))).then((function(t){return function(e,t){if(e.closed)return Promise.resolve([]);var n=e.db.transaction(Qt,"readwrite",Vt).objectStore(Qt);return Promise.all(t.map((function(e){var t=n.delete(e);return new Promise((function(e){t.onsuccess=function(){return e()}}))})))}(e,t.map((function(e){return e.id})))}));var t,n,r,o,i,s}function Xt(e){e.closed||Zt(e).then((function(){return Bt(e.options.idb.fallbackInterval)})).then((function(){return Xt(e)}))}function Zt(e){return e.closed?Dt:e.messagesCallback?Ht(e.db,e.lastCursorId).then((function(t){var n=t.filter((function(e){return!!e})).map((function(t){return t.id>e.lastCursorId&&(e.lastCursorId=t.id),t})).filter((function(t){return function(e,t){return!(e.uuid===t.uuid||t.eMIs.has(e.id)||e.data.time<t.messagesCallbackTime)}(t,e)})).sort((function(e,t){return e.time-t.time}));return n.forEach((function(t){e.messagesCallback&&(e.eMIs.add(t.id),e.messagesCallback(t.data))})),Dt})):Dt}var en={create:function(e,t){return t=qt(t),function(e){var t=Jt(),n=Wt+e,r=t.open(n);return r.onupgradeneeded=function(e){e.target.result.createObjectStore(Qt,{keyPath:"id",autoIncrement:!0})},new Promise((function(e,t){r.onerror=function(e){return t(e)},r.onsuccess=function(){e(r.result)}}))}(e).then((function(n){var r={closed:!1,lastCursorId:0,channelName:e,options:t,uuid:Mt(),eMIs:new Ut(2*t.idb.ttl),writeBlockPromise:Dt,messagesCallback:null,readQueuePromises:[],db:n};return n.onclose=function(){r.closed=!0,t.idb.onclose&&t.idb.onclose()},Xt(r),r}))},close:function(e){e.closed=!0,e.db.close()},onMessage:function(e,t,n){e.messagesCallbackTime=n,e.messagesCallback=t,Zt(e)},postMessage:function(e,t){return e.writeBlockPromise=e.writeBlockPromise.then((function(){return function(e,t,n){var r={uuid:t,time:(new Date).getTime(),data:n},o=e.transaction([Qt],"readwrite",Vt);return new Promise((function(e,t){o.oncomplete=function(){return e()},o.onerror=function(e){return t(e)},o.objectStore(Qt).add(r),Gt(o)}))}(e.db,e.uuid,t)})).then((function(){var t,n;0===(t=0,n=10,Math.floor(Math.random()*(n-t+1)+t))&&Yt(e)})),e.writeBlockPromise},canBeUsed:function(){return!!Jt()},type:"idb",averageResponseTime:function(e){return 2*e.idb.fallbackInterval},microSeconds:Kt},tn="pubkey.broadcastChannel-";function nn(){var e;if("undefined"==typeof window)return null;try{e=window.localStorage,e=window["ie8-eventlistener/storage"]||window.localStorage}catch(e){}return e}function rn(e){return tn+e}function on(){var e=nn();if(!e)return!1;try{var t="__broadcastchannel_check";e.setItem(t,"works"),e.removeItem(t)}catch(e){return!1}return!0}var sn,an={create:function(e,t){if(t=qt(t),!on())throw new Error("BroadcastChannel: localstorage cannot be used");var n=Mt(),r=new Ut(t.localstorage.removeTimeout),o={channelName:e,uuid:n,eMIs:r};return o.listener=function(e,t){var n=rn(e),r=function(e){e.key===n&&t(JSON.parse(e.newValue))};return window.addEventListener("storage",r),r}(e,(function(e){o.messagesCallback&&e.uuid!==n&&e.token&&!r.has(e.token)&&(e.data.time&&e.data.time<o.messagesCallbackTime||(r.add(e.token),o.messagesCallback(e.data)))})),o},close:function(e){var t;t=e.listener,window.removeEventListener("storage",t)},onMessage:function(e,t,n){e.messagesCallbackTime=n,e.messagesCallback=t},postMessage:function(e,t){return new Promise((function(n){Bt().then((function(){var r=rn(e.channelName),o={token:Mt(),time:(new Date).getTime(),data:t,uuid:e.uuid},i=JSON.stringify(o);nn().setItem(r,i);var s=document.createEvent("Event");s.initEvent("storage",!0,!0),s.key=r,s.newValue=i,window.dispatchEvent(s),n()}))}))},canBeUsed:on,type:"localstorage",averageResponseTime:function(){var e=navigator.userAgent.toLowerCase();return e.includes("safari")&&!e.includes("chrome")?240:120},microSeconds:Kt},cn=Kt,un=new Set,ln={create:function(e){var t={name:e,messagesCallback:null};return un.add(t),t},close:function(e){un.delete(e)},onMessage:function(e,t){e.messagesCallback=t},postMessage:function(e,t){return new Promise((function(n){return setTimeout((function(){Array.from(un).filter((function(t){return t.name===e.name})).filter((function(t){return t!==e})).filter((function(e){return!!e.messagesCallback})).forEach((function(e){return e.messagesCallback(t)})),n()}),5)}))},canBeUsed:function(){return!0},type:"simulate",averageResponseTime:function(){return 5},microSeconds:cn},fn=[Ft,en,an],dn=new Set,hn=0,pn=function(e,t){var n,r,o;this.id=hn++,dn.add(this),this.name=e,sn&&(t=sn),this.options=qt(t),this.method=function(e){var t=[].concat(e.methods,fn).filter(Boolean);if(e.type){if("simulate"===e.type)return ln;var n=t.find((function(t){return t.type===e.type}));if(n)return n;throw new Error("method-type "+e.type+" not found")}e.webWorkerSupport||(t=t.filter((function(e){return"idb"!==e.type})));var r=t.find((function(e){return e.canBeUsed()}));if(r)return r;throw new Error("No usable method found in "+JSON.stringify(fn.map((function(e){return e.type}))))}(this.options),this._iL=!1,this._onML=null,this._addEL={message:[],internal:[]},this._uMP=new Set,this._befC=[],this._prepP=null,(o=r=(n=this).method.create(n.name,n.options))&&"function"==typeof o.then?(n._prepP=r,r.then((function(e){n._state=e}))):n._state=r};function mn(e,t,n){var r={time:e.method.microSeconds(),type:t,data:n};return(e._prepP?e._prepP:Dt).then((function(){var t=e.method.postMessage(e._state,r);return e._uMP.add(t),t.catch().then((function(){return e._uMP.delete(t)})),t}))}function vn(e){return e._addEL.message.length>0||e._addEL.internal.length>0}function yn(e,t,n){e._addEL[t].push(n),function(e){if(!e._iL&&vn(e)){var t=function(t){e._addEL[t.type].forEach((function(e){var n=1e5,r=e.time-n;t.time>=r&&e.fn(t.data)}))},n=e.method.microSeconds();e._prepP?e._prepP.then((function(){e._iL=!0,e.method.onMessage(e._state,t,n)})):(e._iL=!0,e.method.onMessage(e._state,t,n))}}(e)}function bn(e,t,n){e._addEL[t]=e._addEL[t].filter((function(e){return e!==n})),function(e){if(e._iL&&!vn(e)){e._iL=!1;var t=e.method.microSeconds();e.method.onMessage(e._state,null,t)}}(e)}pn._pubkey=!0,pn.prototype={postMessage:function(e){if(this.closed)throw new Error("BroadcastChannel.postMessage(): Cannot post message after channel has closed "+JSON.stringify(e));return mn(this,"message",e)},postInternal:function(e){return mn(this,"internal",e)},set onmessage(e){var t={time:this.method.microSeconds(),fn:e};bn(this,"message",this._onML),e&&"function"==typeof e?(this._onML=t,yn(this,"message",t)):this._onML=null},addEventListener:function(e,t){yn(this,e,{time:this.method.microSeconds(),fn:t})},removeEventListener:function(e,t){bn(this,e,this._addEL[e].find((function(e){return e.fn===t})))},close:function(){var e=this;if(!this.closed){dn.delete(this),this.closed=!0;var t=this._prepP?this._prepP:Dt;return this._onML=null,this._addEL.message=[],t.then((function(){return Promise.all(Array.from(e._uMP))})).then((function(){return Promise.all(e._befC.map((function(e){return e()})))})).then((function(){return e.method.close(e._state)}))}},get type(){return this.method.type},get isClosed(){return this.closed}};var gn="[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0)?function(e){process.on("exit",(function(){return e()})),process.on("beforeExit",(function(){return e().then((function(){return process.exit()}))})),process.on("SIGINT",(function(){return e().then((function(){return process.exit()}))})),process.on("uncaughtException",(function(t){return e().then((function(){console.trace(t),process.exit(101)}))}))}:function(e){if("function"==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope){var t=self.close.bind(self);self.close=function(){return e(),t()}}else{if("function"!=typeof window.addEventListener)return;window.addEventListener("beforeunload",(function(){e()}),!0),window.addEventListener("unload",(function(){e()}),!0)}},wn=new Set,_n=!1;function xn(e){if(_n||(_n=!0,gn(Sn)),"function"!=typeof e)throw new Error("Listener is no function");return wn.add(e),{remove:function(){return wn.delete(e)},run:function(){return wn.delete(e),e()}}}function Sn(){var e=[];return wn.forEach((function(t){e.push(t()),wn.delete(t)})),Promise.all(e)}function En(e,t){var n={context:"leader",action:t,token:e.token};return e.broadcastChannel.postInternal(n)}function On(e){e.isLeader=!0,e._hasLeader=!0;var t=xn((function(){return e.die()}));e._unl.push(t);var n=function(t){"leader"===t.context&&"apply"===t.action&&En(e,"tell"),"leader"!==t.context||"tell"!==t.action||e._dpLC||(e._dpLC=!0,e._dpL(),En(e,"tell"))};return e.broadcastChannel.addEventListener("internal",n),e._lstns.push(n),En(e,"tell")}var In=function(e,t){var n=this;this.broadcastChannel=e,this._options=t,this.isLeader=!1,this._hasLeader=!1,this.isDead=!1,this.token=Mt(),this._aplQ=Dt,this._aplQC=0,this._unl=[],this._lstns=[],this._dpL=function(){},this._dpLC=!1;var r=function(e){"leader"===e.context&&("death"===e.action&&(n._hasLeader=!1),"tell"===e.action&&(n._hasLeader=!0))};this.broadcastChannel.addEventListener("internal",r),this._lstns.push(r)};In.prototype={hasLeader:function(){return Promise.resolve(this._hasLeader)},applyOnce:function(e){var t=this;return this.isLeader?Bt(0,!0):this.isDead?Bt(0,!1):this._aplQC>1?this._aplQ:(this._aplQC=this._aplQC+1,this._aplQ=this._aplQ.then((function(){return function(){if(t.isLeader)return Lt;var n,r=!1,o=new Promise((function(e){n=function(){r=!0,e()}})),i=function(e){"leader"===e.context&&e.token!=t.token&&("apply"===e.action&&e.token>t.token&&n(),"tell"===e.action&&(n(),t._hasLeader=!0))};t.broadcastChannel.addEventListener("internal",i);var s=e?4*t._options.responseTime:t._options.responseTime;return En(t,"apply").then((function(){return Promise.race([Bt(s),o.then((function(){return Promise.reject(new Error)}))])})).then((function(){return En(t,"apply")})).then((function(){return Promise.race([Bt(s),o.then((function(){return Promise.reject(new Error)}))])})).catch((function(){})).then((function(){return t.broadcastChannel.removeEventListener("internal",i),!r&&On(t).then((function(){return!0}))}))}()})).then((function(){t._aplQC=t._aplQC-1})),this._aplQ.then((function(){return t.isLeader})))},awaitLeadership:function(){return this._aLP||(this._aLP=function(e){return e.isLeader?Dt:new Promise((function(t){var n=!1;function r(){n||(n=!0,e.broadcastChannel.removeEventListener("internal",o),t(!0))}e.applyOnce().then((function(){e.isLeader&&r()})),function t(){return Bt(e._options.fallbackInterval).then((function(){if(!e.isDead&&!n)return e.isLeader?void r():e.applyOnce(!0).then((function(){e.isLeader?r():t()}))}))}();var o=function(t){"leader"===t.context&&"death"===t.action&&(e._hasLeader=!1,e.applyOnce().then((function(){e.isLeader&&r()})))};e.broadcastChannel.addEventListener("internal",o),e._lstns.push(o)}))}(this)),this._aLP},set onduplicate(e){this._dpL=e},die:function(){var e=this;return this._lstns.forEach((function(t){return e.broadcastChannel.removeEventListener("internal",t)})),this._lstns=[],this._unl.forEach((function(e){return e.remove()})),this._unl=[],this.isLeader&&(this._hasLeader=!1,this.isLeader=!1),this.isDead=!0,En(this,"death")}};var Pn=new Map;function kn(e,t){var n=Pn.get(e);if(n)return n.refs.delete(t),0===n.refs.size?(Pn.delete(e),n.bc.close()):void 0}function jn(e,t,n,r){if(t.multiInstance){var o,i,s,a,c=r||(o=t.databaseInstanceToken,i=n.databaseName,s=n,(a=Pn.get(o))||(a={bc:new pn("RxDB:"+i),refs:new Set},Pn.set(o,a)),a.refs.add(s),a.bc),u=new ct,l=n=>{n.storageName===e&&n.databaseName===t.databaseName&&n.collectionName===t.collectionName&&n.version===t.schema.version&&u.next(n.eventBulk)};c.addEventListener("message",l);var f=n.changeStream(),d=!1,h=f.subscribe((n=>{d||c.postMessage({storageName:e,databaseName:t.databaseName,collectionName:t.collectionName,version:t.schema.version,eventBulk:n})}));n.changeStream=function(){return u.asObservable().pipe(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Ct.apply(void 0,ke([],Pe(e)))}(f))};var p=n.close.bind(n);n.close=async function(){return d=!0,h.unsubscribe(),c.removeEventListener("message",l),r||await kn(t.databaseInstanceToken,n),p()};var m=n.remove.bind(n);n.remove=async function(){return d=!0,h.unsubscribe(),c.removeEventListener("message",l),r||await kn(t.databaseInstanceToken,n),m()}}}const Nn=Number.MAX_SAFE_INTEGER,An=Number.MIN_SAFE_INTEGER,$n=Symbol("missing"),Cn=Object.getPrototypeOf({}),Ln=/^\[object ([a-zA-Z0-9]+)\]$/,Dn=e=>{const t=lr(e);let n=0,r=t.length;for(;r;)n=(n<<5)-n^t.charCodeAt(--r);return n>>>0},Bn=new Set(["null","undefined","boolean","number","string","date","regexp"]),Mn={null:0,undefined:0,number:1,string:2,object:3,array:4,boolean:5,date:6,regexp:7,function:8},Tn=(e,t)=>{e===$n&&(e=void 0),t===$n&&(t=void 0);const[n,r]=[e,t].map((e=>Mn[Fn(e).toLowerCase()]));return n!==r?n-r:1===n||2===n||6===n?e<t?-1:e>t?1:0:ur(e,t)?0:e<t?-1:e>t?1:0};function Rn(e,t){if(!e)throw new Error(t)}const Kn=e=>{const t=new Map,n=e=>{if(t.has(e))throw new Error("cycle detected during clone operation.");t.set(e,!0)},r=e=>{if(e instanceof Date)return new Date(e);if(Wn(e)){n(e);const t=new Array(e.length),o=e.length;for(let n=0;n<o;n++)t[n]=r(e[n]);return t}if(Qn(e)){n(e);const t={};for(const n in e)t[n]=r(e[n]);return t}return e};return r(e)},Fn=e=>Ln.exec(Object.prototype.toString.call(e))[1],Un=e=>"boolean"==typeof e,zn=e=>"string"==typeof e,qn=e=>!isNaN(e)&&"number"==typeof e,Wn=Array.isArray,Qn=e=>{if(!e)return!1;const t=Object.getPrototypeOf(e);return(t===Cn||null===t)&&"[object Object]"===Object.prototype.toString.call(e)},Vn=e=>e===Object(e),Jn=e=>e instanceof Date,Gn=e=>e instanceof RegExp,Hn=e=>"function"==typeof e,Yn=e=>null==e,Xn=(e,t)=>e.includes(t),Zn=(e,t)=>!Xn(e,t),er=e=>Yn(e)||zn(e)&&!e||e instanceof Array&&0===e.length||Qn(e)&&0===Object.keys(e).length,tr=e=>e===$n,nr=e=>e instanceof Array?e:[e],rr=(e,t)=>!!e&&Object.prototype.hasOwnProperty.call(e,t),or=(e,t)=>Qn(e)&&Qn(t)||Wn(e)&&Wn(t);function ir(e,t,n){if(n=n||{flatten:!1},tr(e)||Yn(e))return t;if(tr(t)||Yn(t))return e;if(!or(e,t)){if(n.skipValidation)return t||e;throw Error("mismatched types. must both be array or object")}if(n.skipValidation=!0,Wn(e)){const r=e,o=t;if(n.flatten){let e=0,i=0;for(;e<r.length&&i<o.length;)r[e]=ir(r[e++],o[i++],n);for(;i<o.length;)r.push(t[i++])}else pr(r,o)}else for(const r in t)e[r]=ir(e[r],t[r],n);return e}function sr(e,t=Dn){const n=new Map;return e.forEach(((r,o)=>{const i=fr(r,t);n.has(i)?n.get(i).some((t=>ur(e[t],r)))||n.get(i).push(o):n.set(i,[o])})),n}function ar(e,t=Dn){if(e.some((e=>0==e.length)))return[];if(1===e.length)return Array.from(e);const n=function(e,t,n=Tn){if(er(e))return e;const r=new Array,o=new Array;for(let n=0;n<e.length;n++){const i=e[n],s=t(i,n);Yn(s)?o.push(i):r.push([s,i])}return r.sort(((e,t)=>n(e[0],t[0]))),pr(o,r.map((e=>e[1])))}(e.map(((e,t)=>[t,e.length])),(e=>e[1])),r=e[n[0][0]],o=sr(r,t),i=new Map,s=new Array;return o.forEach(((t,o)=>{const a=t.map((e=>r[e])),c=a.map((e=>0)),u=a.map((e=>[n[0][0],0]));let l=!1;for(let t=1;t<e.length;t++){const[r,s]=n[t],f=e[r];if(i.has(t)||i.set(t,sr(f)),i.get(t).has(o)){const e=i.get(t).get(o).map((e=>f[e]));l=a.map(((n,s)=>e.some(((e,a)=>{const l=c[s];return ur(n,e)&&(c[s]++,r<u[s][0]&&(u[s]=[r,i.get(t).get(o)[a]])),l<c[s]})))).some(Boolean)}if(!l)return}l&&pr(s,c.map(((t,n)=>t===e.length-1?[a[n],u[n]]:$n)).filter((e=>e!==$n)))})),s.sort(((e,t)=>{const[n,[r,o]]=e,[i,[s,a]]=t,c=Tn(r,s);return 0!==c?c:Tn(o,a)})).map((e=>e[0]))}function cr(e,t=0){const n=new Array;return function e(t,r){for(let o=0,i=t.length;o<i;o++)Wn(t[o])&&(r>0||r<0)?e(t[o],Math.max(-1,r-1)):n.push(t[o])}(e,t),n}function ur(e,t){const n=[e],r=[t];for(;n.length>0;){if((e=n.pop())===(t=r.pop()))continue;const o=Fn(e).toLowerCase();if(o!==Fn(t).toLowerCase()||"function"===o)return!1;if("array"===o){const o=e,i=t;if(o.length!==i.length)return!1;if(o.length===i.length&&0===o.length)continue;pr(n,o),pr(r,i)}else if("object"===o){const o=Object.keys(e),i=Object.keys(t);if(o.length!==i.length)return!1;for(let i=0,s=o.length;i<s;i++){const s=o[i];if(!rr(t,s))return!1;n.push(e[s]),r.push(t[s])}}else if(lr(e)!==lr(t))return!1}return 0===n.length}function lr(e){const t=Fn(e).toLowerCase();switch(t){case"boolean":case"number":case"regexp":return e.toString();case"string":return JSON.stringify(e);case"date":return e.toISOString();case"null":case"undefined":return t;case"array":return"["+e.map(lr).join(",")+"]"}const n="object"===t?"":`${Fn(e)}`,r=Object.keys(e);return r.sort(),`${n}{`+r.map((t=>`${lr(t)}:${lr(e[t])}`)).join(",")+"}"}function fr(e,t){return t=t||Dn,Yn(e)?null:t(e).toString()}function dr(e,t,n=Dn){if(e.length<1)return new Map;const r=new Map,o=new Map;for(let i=0;i<e.length;i++){const s=e[i],a=t(s,i),c=fr(a,n);if(null===c)o.has(null)?o.get(null).push(s):o.set(null,[s]);else{const e=r.has(c)?r.get(c).find((e=>ur(e,a))):null;Yn(e)?(o.set(a,[s]),r.has(c)?r.get(c).push(a):r.set(c,[a])):o.get(e).push(s)}}return o}const hr=5e4;function pr(e,...t){return e instanceof Array?t.reduce(((e,t)=>{let n=Math.ceil(t.length/hr),r=0;for(;n-- >0;)Array.prototype.push.apply(e,t.slice(r,r+hr)),r+=hr;return e}),e):t.filter(Vn).reduce(((e,t)=>(Object.assign(e,t),e)),e)}function mr(e,t){return Vn(e)?e[t]:void 0}function vr(e,t,n){let r=0;const o=Bn.has(Fn(e).toLowerCase())?e:function e(t,n){let o=t;for(let t=0;t<n.length;t++){const i=n[t];if(null===/^\d+$/.exec(i)&&o instanceof Array){if(0===t&&r>0)break;r+=1;const i=n.slice(t);o=o.reduce(((t,n)=>{const r=e(n,i);return void 0!==r&&t.push(r),t}),[]);break}if(o=mr(o,i),void 0===o)break}return o}(e,t.split("."));return o instanceof Array&&(null==n?void 0:n.unwrapArray)?function(e,t){if(t<1)return e;for(;t--&&1===e.length;)e=e[0];return e}(o,r):o}function yr(e,t,n){const r=t.split("."),o=r[0],i=r.slice(1).join("."),s=null!==/^\d+$/.exec(o),a=r.length>1;let c,u;if(e instanceof Array)if(s)c=mr(e,Number(o)),a&&(c=yr(c,i,n)),c=[c];else{c=[];for(const r of e)u=yr(r,t,n),(null==n?void 0:n.preserveMissing)?(void 0===u&&(u=$n),c.push(u)):void 0!==u&&c.push(u)}else{if(u=mr(e,o),a&&(u=yr(u,i,n)),void 0===u)return;c=(null==n?void 0:n.preserveKeys)?Object.assign({},e):{},c[o]=u}return c}function br(e){if(e instanceof Array)for(let t=e.length-1;t>=0;t--)e[t]===$n?e.splice(t,1):br(e[t]);else if(Qn(e))for(const t in e)rr(e,t)&&br(e[t])}const gr=/^\d+$/;function wr(e,t,n,r){const o=t.split("."),i=o[0],s=o.slice(1).join(".");if(1===o.length)(Qn(e)||Wn(e)&&gr.test(i))&&n(e,i);else{(null==r?void 0:r.buildGraph)&&Yn(e[i])&&(e[i]={});const t=e[i];if(!t)return;const a=!!(o.length>1&&gr.test(o[1]));t instanceof Array&&(null==r?void 0:r.descendArray)&&!a?t.forEach((e=>wr(e,s,n,r))):wr(t,s,n,r)}}function _r(e,t,n){wr(e,t,((e,t)=>{e[t]=n}),{buildGraph:!0})}function xr(e,t,n){wr(e,t,((e,t)=>{if(e instanceof Array){if(/^\d+$/.test(t))e.splice(parseInt(t),1);else if(n&&n.descendArray)for(const n of e)Qn(n)&&delete n[t]}else Qn(e)&&delete e[t]}),n)}const Sr=/^\$[a-zA-Z0-9_]+$/;function Er(e){return Sr.test(e)}function Or(e){if(Bn.has(Fn(e).toLowerCase()))return Gn(e)?{$regex:e}:{$eq:e};if(Vn(e)){const t=e;if(!Object.keys(t).some(Er))return{$eq:e};if(rr(e,"$regex")){const t=Object.assign({},e);return t.$regex=new RegExp(e.$regex,e.$options),delete t.$options,t}}return e}var Ir,Pr;!function(e){e.CLONE_ALL="CLONE_ALL",e.CLONE_INPUT="CLONE_INPUT",e.CLONE_OUTPUT="CLONE_OUTPUT",e.CLONE_OFF="CLONE_OFF"}(Ir||(Ir={}));class kr{constructor(e,t,n,r=Date.now()){this._opts=e,this._root=t,this._local=n,this.timestamp=r,this.update(t,n)}static init(e,t,n){return e instanceof kr?new kr(e._opts,Yn(e.root)?t:e.root,Object.assign({},e.local,n)):new kr(e,t,n)}update(e,t){var n;return this._root=e,this._local=t?Object.assign({},t,{variables:Object.assign({},null===(n=this._local)||void 0===n?void 0:n.variables,null==t?void 0:t.variables)}):t,this}getOptions(){return Object.freeze(Object.assign(Object.assign({},this._opts),{context:Nr.from(this._opts.context)}))}get root(){return this._root}get local(){return this._local}get idKey(){return this._opts.idKey}get collation(){var e;return null===(e=this._opts)||void 0===e?void 0:e.collation}get processingMode(){var e;return(null===(e=this._opts)||void 0===e?void 0:e.processingMode)||Ir.CLONE_OFF}get useStrictMode(){var e;return null===(e=this._opts)||void 0===e?void 0:e.useStrictMode}get scriptEnabled(){var e;return null===(e=this._opts)||void 0===e?void 0:e.scriptEnabled}get useGlobalContext(){var e;return null===(e=this._opts)||void 0===e?void 0:e.useGlobalContext}get hashFunction(){var e;return null===(e=this._opts)||void 0===e?void 0:e.hashFunction}get collectionResolver(){var e;return null===(e=this._opts)||void 0===e?void 0:e.collectionResolver}get jsonSchemaValidator(){var e;return null===(e=this._opts)||void 0===e?void 0:e.jsonSchemaValidator}get variables(){var e;return null===(e=this._opts)||void 0===e?void 0:e.variables}get context(){var e;return null===(e=this._opts)||void 0===e?void 0:e.context}}function jr(e){return e instanceof kr?e.getOptions():Object.freeze(Object.assign(Object.assign({idKey:"_id",scriptEnabled:!0,useStrictMode:!0,useGlobalContext:!0,processingMode:Ir.CLONE_OFF},e),{context:(null==e?void 0:e.context)?Nr.from(null==e?void 0:e.context):Nr.init({})}))}!function(e){e.ACCUMULATOR="accumulator",e.EXPRESSION="expression",e.PIPELINE="pipeline",e.PROJECTION="projection",e.QUERY="query",e.WINDOW="window"}(Pr||(Pr={}));class Nr{constructor(e){this.operators=Kn(e)}static init(e){return new Nr(ir({[Pr.ACCUMULATOR]:{},[Pr.EXPRESSION]:{},[Pr.PIPELINE]:{},[Pr.PROJECTION]:{},[Pr.QUERY]:{},[Pr.WINDOW]:{}},e,{skipValidation:!0}))}static from(e){return new Nr(e.operators)}addOperators(e,t){for(const[n,r]of Object.entries(t))this.getOperator(e,n)||(this.operators[e][n]=r);return this}addAccumulatorOps(e){return this.addOperators(Pr.ACCUMULATOR,e)}addExpressionOps(e){return this.addOperators(Pr.EXPRESSION,e)}addQueryOps(e){return this.addOperators(Pr.QUERY,e)}addPipelineOps(e){return this.addOperators(Pr.PIPELINE,e)}addProjectionOps(e){return this.addOperators(Pr.PROJECTION,e)}addWindowOps(e){return this.addOperators(Pr.WINDOW,e)}getOperator(e,t){return e in this.operators&&this.operators[e][t]||null}}const Ar=Nr.init({});function $r(e,t){for(const[n,r]of Object.entries(t)){Rn(Hn(r)&&Er(n),`'${n}' is not a valid operator`);const t=Cr(e,n,null);Rn(!t||r===t,`${n} already exists for '${e}' operators. Cannot change operator function once registered.`)}Ar.addOperators(e,t)}function Cr(e,t,n){const{context:r,useGlobalContext:o}=n||{},i=r?r.getOperator(e,t):null;return!i&&o?Ar.getOperator(e,t):i}const Lr={$$ROOT:(e,t,n)=>n.root,$$CURRENT:(e,t,n)=>e,$$REMOVE(e,t,n){},$$NOW:(e,t,n)=>new Date(n.timestamp)},Dr={$$KEEP:(e,t,n)=>e,$$PRUNE(e,t,n){},$$DESCEND(e,t,n){if(!rr(t,"$cond"))return e;let r;for(const[o,i]of Object.entries(e))if(Vn(i)){if(i instanceof Array){const e=[];for(let r of i)Qn(r)&&(r=Mr(r,t,n.update(r))),Yn(r)||e.push(r);r=e}else r=Mr(i,t,n.update(i));Yn(r)?delete e[o]:e[o]=r}return e}};function Br(e,t,n,r){var o;const i=kr.init(r,e);if(Er(n=n||"")){const o=Cr(Pr.EXPRESSION,n,r);if(o)return o(e,t,i);const s=Cr(Pr.ACCUMULATOR,n,r);if(s)return e instanceof Array||(e=Br(e,t,null,i),t=null),Rn(e instanceof Array,`'${n}' target must be an array.`),s(e,t,i.update(null,i.local));throw new Error(`operator '${n}' is not registered`)}if(zn(t)&&t.length>0&&"$"===t[0]){if(rr(Dr,t))return t;let n=i.root;const r=t.split(".");if(rr(Lr,r[0]))n=Lr[r[0]](e,null,i),t=t.slice(r[0].length+1);else if("$$"===r[0].slice(0,2)){n=Object.assign({},i.variables,{this:e},null===(o=i.local)||void 0===o?void 0:o.variables);const s=r[0].slice(2);Rn(rr(n,s),`Use of undefined variable: ${s}`),t=t.slice(2)}else t=t.slice(1);return""===t?n:vr(n,t)}if(Wn(t))return t.map((t=>Br(e,t,null,i)));if(Qn(t)){const n={};for(const[o,s]of Object.entries(t))if(n[o]=Br(e,s,o,i),[Pr.EXPRESSION,Pr.ACCUMULATOR].some((e=>!!Cr(e,o,r))))return Rn(1===Object.keys(t).length,"Invalid aggregation expression '"+JSON.stringify(t)+"'"),n[o];return n}return t}function Mr(e,t,n){const r=Br(e,t,null,n);return rr(Dr,r)?Dr[r](e,t,n):r}function Tr(e){return e instanceof Ur?e:new Ur(e)}function Rr(e,t){const n=e.slice(t+1);e.splice(t),Array.prototype.push.apply(e,n)}const Kr=new Error;var Fr;!function(e){e[e.MAP=0]="MAP",e[e.FILTER=1]="FILTER",e[e.TAKE=2]="TAKE",e[e.DROP=3]="DROP"}(Fr||(Fr={}));class Ur{constructor(e){let t;if(this.iteratees=[],this.yieldedValues=[],this.isDone=!1,e instanceof Function&&(e={next:e}),(n=e)&&"object"==typeof n&&(null==n?void 0:n.next)instanceof Function){const n=e;t=()=>{const e=n.next();if(e.done)throw Kr;return e.value}}else if(e instanceof Array){const n=e,r=n.length;let o=0;t=()=>{if(o<r)return n[o++];throw Kr}}else if(!(e instanceof Function))throw new Error(`Source is of type '${typeof e}'. Must be Array, Function, or Generator`);var n;this.getNext=function(e,t,n){let r=!1,o=-1,i=0;return function(s){try{e:for(;!r;){let a=e();o++;let c=-1;const u=t.length;let l=!1;for(;++c<u;){const e=t[c];switch(e.action){case Fr.MAP:a=e.func(a,o);break;case Fr.FILTER:if(!e.func(a,o))continue e;break;case Fr.TAKE:--e.count,e.count||(l=!0);break;case Fr.DROP:--e.count,e.count||Rr(t,c);continue e;default:break e}}if(r=l,!s)return{value:a,done:!1};n[i++]=a}}catch(e){if(e!==Kr)throw e}return r=!0,{done:r}}}(t,this.iteratees,this.yieldedValues)}push(e,t){return"function"==typeof t?this.iteratees.push({action:e,func:t}):"number"==typeof t&&this.iteratees.push({action:e,count:t}),this}next(){return this.getNext()}map(e){return this.push(Fr.MAP,e)}filter(e){return this.push(Fr.FILTER,e)}take(e){return e>0?this.push(Fr.TAKE,e):this}drop(e){return e>0?this.push(Fr.DROP,e):this}transform(e){const t=this;let n;return Tr((()=>(n||(n=Tr(e(t.value()))),n.next())))}value(){return this.isDone||(this.isDone=this.getNext(!0).done),this.yieldedValues}each(e){for(;;){const t=this.next();if(t.done)break;if(!1===e(t.value))return!1}return!0}reduce(e,t){let n=this.next();for(void 0!==t||n.done||(t=n.value,n=this.next());!n.done;)t=e(t,n.value),n=this.next();return t}size(){return this.reduce(((e,t)=>++e),0)}[Symbol.iterator](){return this}}class zr{constructor(e,t){this.pipeline=e,this.options=jr(t)}stream(e){let t=Tr(e);const n=this.options.processingMode;n!=Ir.CLONE_ALL&&n!=Ir.CLONE_INPUT||t.map(Kn);const r=new Array;if(!er(this.pipeline))for(const e of this.pipeline){const n=Object.keys(e),o=n[0],i=Cr(Pr.PIPELINE,o,this.options);Rn(1===n.length&&!!i,`invalid pipeline operator ${o}`),r.push(o),t=i(t,e[o],this.options)}return(n==Ir.CLONE_OUTPUT||n==Ir.CLONE_ALL&&ar([["$group","$unwind"],r]).length)&&t.map(Kn),t}run(e){return this.stream(e).value()}}class qr{constructor(e,t,n,r){this.source=e,this.predicate=t,this.projection=n,this.options=r,this.operators=[],this.result=null,this.buffer=[]}fetch(){return this.result||(Qn(this.projection)&&this.operators.push({$project:this.projection}),this.result=Tr(this.source).filter(this.predicate),this.operators.length>0&&(this.result=new zr(this.operators,this.options).stream(this.result))),this.result}fetchAll(){const e=Tr([...this.buffer]);return this.buffer=[],function(...e){let t=0;return Tr((()=>{for(;t<e.length;){const n=e[t].next();if(!n.done)return n;t++}return{done:!0}}))}(e,this.fetch())}all(){return this.fetchAll().value()}count(){return this.all().length}skip(e){return this.operators.push({$skip:e}),this}limit(e){return this.operators.push({$limit:e}),this}sort(e){return this.operators.push({$sort:e}),this}collation(e){return this.options=Object.assign(Object.assign({},this.options),{collation:e}),this}next(){if(this.buffer.length>0)return this.buffer.pop();const e=this.fetch().next();return e.done?void 0:e.value}hasNext(){if(this.buffer.length>0)return!0;const e=this.fetch().next();return!e.done&&(this.buffer.push(e.value),!0)}map(e){return this.all().map(e)}forEach(e){this.all().forEach(e)}[Symbol.iterator](){return this.fetchAll()}}class Wr{constructor(e,t){this.condition=e,this.options=jr(t),this.compiled=[],this.compile()}compile(){Rn(Qn(this.condition),"query criteria must be an object");const e={};for(const[t,n]of Object.entries(this.condition)){if("$where"===t)Object.assign(e,{field:t,expr:n});else if(Xn(["$and","$or","$nor","$expr","$jsonSchema"],t))this.processOperator(t,t,n);else{Rn(!Er(t),`unknown top level operator: ${t}`);for(const[e,r]of Object.entries(Or(n)))this.processOperator(t,e,r)}e.field&&this.processOperator(e.field,e.field,e.expr)}}processOperator(e,t,n){const r=Cr(Pr.QUERY,t,this.options);if(!r)throw new Error(`unknown operator ${t}`);const o=r(e,n,this.options);this.compiled.push(o)}test(e){for(let t=0,n=this.compiled.length;t<n;t++)if(!this.compiled[t](e))return!1;return!0}find(e,t){return new qr(e,(e=>this.test(e)),t||{},this.options)}remove(e){return e.reduce(((e,t)=>(this.test(t)||e.push(t),e)),[])}}function Qr(e){const t=(t,n,r)=>{const o={unwrapArray:!0},i=Math.max(1,t.split(".").length-1);return s=>{const a=vr(s,t,o);return e(a,n,Object.assign(Object.assign({},r),{depth:i}))}};return t.op="query",t}function Vr(e){return(t,n,r)=>{const o=Br(t,n,null,r);return e(...o)}}function Jr(e,t,n){if(ur(e,t))return!0;if(Yn(e)&&Yn(t))return!0;if(e instanceof Array){const r=ur.bind(null,t);return e.some(r)||cr(e,null==n?void 0:n.depth).some(r)}return!1}function Gr(e,t,n){return!Jr(e,t,n)}function Hr(e,t,n){return Yn(e)?t.some((e=>null===e)):ar([nr(e),t],null==n?void 0:n.hashFunction).length>0}function Yr(e,t,n){return!Hr(e,t,n)}function Xr(e,t,n){return uo(e,t,((e,t)=>Tn(e,t)<0))}function Zr(e,t,n){return uo(e,t,((e,t)=>Tn(e,t)<=0))}function eo(e,t,n){return uo(e,t,((e,t)=>Tn(e,t)>0))}function to(e,t,n){return uo(e,t,((e,t)=>Tn(e,t)>=0))}function no(e){return Er(e)&&-1===["$and","$or","$nor"].indexOf(e)}function ro(e,t,n){if(Wn(e)&&!er(e)){let r=e=>e,o=t;Object.keys(t).every(no)&&(o={temp:t},r=e=>({temp:e}));const i=new Wr(o,n);for(let t=0,n=e.length;t<n;t++)if(i.test(r(e[t])))return!0}return!1}new WeakMap;const oo=e=>null===e,io=e=>qn(e)&&e>=-2147483648&&e<=2147483647&&-1===e.toString().indexOf("."),so=e=>qn(e)&&e>=An&&e<=Nn&&-1===e.toString().indexOf("."),ao={array:Wn,bool:Un,boolean:Un,date:Jn,decimal:qn,double:qn,int:io,long:so,number:qn,null:oo,object:Qn,regex:Gn,regexp:Gn,string:zn,undefined:Yn,function:e=>{throw new Error("unsupported type key `function`.")},1:qn,2:zn,3:Qn,4:Wn,6:Yn,8:Un,9:Jn,10:oo,11:Gn,16:io,18:so,19:qn};function co(e,t,n){const r=ao[t];return!!r&&r(e)}function uo(e,t,n){return nr(e).some((e=>Fn(e)===Fn(t)&&n(e,t)))}Vr(Yr),Vr(Jr),Vr(eo),Vr(to),Vr(Xr),Vr(Zr),Vr(Gr);const lo=(e,t)=>{const n={};return e.split("").forEach(((e,r)=>n[e]=t*(r+1))),n};Object.assign(Object.assign(Object.assign({},lo("ABCDEFGHIKLM",1)),lo("NOPQRSTUVWXY",-1)),{Z:0});const fo={undefined:null,null:null,NaN:NaN,Infinity:new Error,"-Infinity":new Error};function ho(e,t=fo){const n=Object.assign({},fo,t),r=new Set(Object.keys(n));return(t,o,i)=>{const s=Br(t,o,null,i);if(r.has(`${s}`)){const t=n[`${s}`];if(t instanceof Error)throw new Error(`cannot apply $${e.name} to -inf, value must in (-inf,inf)`);return t}return e(s)}}ho(Math.acos,{Infinity:1/0,0:new Error}),ho(Math.acosh,{Infinity:1/0,0:new Error}),ho(Math.asin),ho(Math.asinh,{Infinity:1/0,"-Infinity":-1/0}),ho(Math.atan),ho(Math.atanh,{1:1/0,"-1":-1/0}),ho(Math.cos),ho(Math.cosh,{"-Infinity":1/0,Infinity:1/0});const po=Math.PI/180,mo=(ho((e=>e*po),{Infinity:1/0,"-Infinity":1/0}),180/Math.PI);ho((e=>e*mo),{Infinity:1/0,"-Infinity":-1/0}),ho(Math.sin),ho(Math.sinh,{"-Infinity":-1/0,Infinity:1/0}),ho(Math.tan);const vo=(e,t,n)=>{if(er(t)||!Qn(t))return e;let r=Tn;const o=n.collation;return Qn(o)&&zn(o.locale)&&(r=function(e){const t={sensitivity:yo[e.strength||3],caseFirst:"off"===e.caseFirst?"false":e.caseFirst||"false",numeric:e.numericOrdering||!1,ignorePunctuation:"shifted"===e.alternate};!0===(e.caseLevel||!1)&&("base"===t.sensitivity&&(t.sensitivity="case"),"accent"===t.sensitivity&&(t.sensitivity="variant"));const n=new Intl.Collator(e.locale,t);return(e,t)=>{if(!zn(e)||!zn(t))return Tn(e,t);const r=n.compare(e,t);return r<0?-1:r>0?1:0}}(o)),e.transform((e=>{const o=Object.keys(t);for(const i of o.reverse()){const o=dr(e,(e=>vr(e,i)),n.hashFunction),s=Array.from(o.keys()).sort(r);-1===t[i]&&s.reverse(),e=[],s.reduce(((e,t)=>pr(e,o.get(t))),e)}return e}))},yo={1:"base",2:"accent",3:"variant"};new Set(["$denseRank","$documentNumber","$first","$last","$linearFill","$rank","$shift"]),new Set(["$denseRank","$expMovingAvg","$linearFill","$locf","$rank","$shift"]);const bo=(e,t,n)=>{if(er(t))return e;let r=Object.keys(t),o=!1;wo(t,n);const i=n.idKey;if(Xn(r,i)){const e=t[i];0!==e&&!1!==e||(r=r.filter(Zn.bind(null,[i])),o=0==r.length)}else r.push(i);const s=kr.init(n);return e.map((e=>go(e,t,s.update(e),r,o)))};function go(e,t,n,r,o){let i={},s=!1,a=!1;const c=[];o&&c.push(n.idKey);for(const o of r){let r;const u=t[o];if(o!==n.idKey&&Xn([0,!1],u)&&(a=!0),o===n.idKey&&er(u))r=e[o];else if(zn(u))r=Br(e,u,o,n);else if(Xn([1,!0],u));else if(u instanceof Array)r=u.map((t=>{const r=Br(e,t,null,n);return Yn(r)?null:r}));else{if(!Qn(u)){c.push(o);continue}{const t=u,i=Object.keys(u),a=1==i.length?i[0]:"",c=Cr(Pr.PROJECTION,a,n);if(c)"$slice"===a?nr(t[a]).every(qn)?(r=c(e,t[a],o,n),s=!0):r=Br(e,t,o,n):r=c(e,t[a],o,n);else if(Er(a))r=Br(e,t[a],a,n);else if(rr(e,o)){wo(t,n);let s=e[o];s instanceof Array?r=s.map((e=>go(e,t,n,i,!1))):(s=Qn(s)?s:e,r=go(s,t,n,i,!1))}else r=Br(e,u,null,n)}}const l=yr(e,o,{preserveMissing:!0});void 0!==l&&ir(i,l,{flatten:!0}),Zn([0,1,!1,!0],u)&&(void 0===r?xr(i,o,{descendArray:!0}):_r(i,o,r))}if(br(i),(s||a||o)&&(i=pr({},e,i),c.length>0))for(const e of c)xr(i,e,{descendArray:!0});return i}function wo(e,t){const n=[!1,!1];for(const[r,o]of Object.entries(e)){if(r===(null==t?void 0:t.idKey))return;0===o||!1===o?n[0]=!0:1!==o&&!0!==o||(n[1]=!0),Rn(!(n[0]&&n[1]),"Projection cannot have a mix of inclusion and exclusion.")}}const _o=(e,t,n)=>{Rn(Wn(t),"Invalid expression: $and expects value to be an Array.");const r=t.map((e=>new Wr(e,n)));return e=>r.every((t=>t.test(e)))},xo=(e,t,n)=>{Rn(Wn(t),"Invalid expression. $or expects value to be an Array");const r=t.map((e=>new Wr(e,n)));return e=>r.some((t=>t.test(e)))},So=(e,t,n)=>{Rn(Wn(t),"Invalid expression. $nor expects value to be an array.");const r=xo("$or",t,n);return e=>!r(e)},Eo=(e,t,n)=>{const r={};r[e]=Or(t);const o=new Wr(r,n);return e=>!o.test(e)},Oo=Qr(Jr),Io=Qr(eo),Po=Qr(to),ko=Qr(Hr),jo=Qr(Xr),No=Qr(Zr),Ao=Qr(Gr),$o=Qr(Yr),Co=Qr((function(e,t,n){return nr(e).some((e=>2===t.length&&e%t[0]===t[1]))})),Lo=Qr((function(e,t,n){const r=nr(e),o=e=>zn(e)&&((e,t=!0)=>!!e||t&&""===e)(t.exec(e),null==n?void 0:n.useStrictMode);return r.some(o)||cr(r,1).some(o)}));Qr((function(e,t,n){if(!(Wn(e)&&Wn(t)&&e.length&&t.length))return!1;let r=!0;for(const o of t){if(!r)break;r=Qn(o)&&Xn(Object.keys(o),"$elemMatch")?ro(e,o.$elemMatch,n):o instanceof RegExp?e.some((e=>"string"==typeof e&&o.test(e))):e.some((e=>ur(o,e)))}return r}));const Do=Qr(ro),Bo=Qr((function(e,t,n){return Array.isArray(e)&&e.length===t})),Mo=Qr((function(e,t,n){return(!1===t||0===t)&&void 0===e||(!0===t||1===t)&&void 0!==e})),To=Qr((function(e,t,n){return Array.isArray(t)?t.findIndex((t=>co(e,t)))>=0:co(e,t)}));var Ro=!1;function Ko(e,t){if(!t.sort)throw l("SNH",{query:t});var n,r=(n=t.selector,Ro||($r(Pr.PIPELINE,{$sort:vo,$project:bo}),$r(Pr.QUERY,{$and:_o,$eq:Oo,$elemMatch:Do,$exists:Mo,$gt:Io,$gte:Po,$in:ko,$lt:jo,$lte:No,$ne:Ao,$nin:$o,$mod:Co,$nor:So,$not:Eo,$or:xo,$regex:Lo,$size:Bo,$type:To}),Ro=!0),new Wr(n));return e=>!e._deleted&&!!r.find([e]).next()}async function Fo(e,t){var n=t.queryPlan,r=t.query,o=r.skip?r.skip:0,i=o+(r.limit?r.limit:1/0),s=e.internals.storeNames.documentStore,a=e.settings.batchSize?e.settings.batchSize:50,c=!1;n.selectorSatisfiedByIndex||(c=Ko(e.schema,r));var u=n.index,f=!n.sortFieldsSameAsIndexFields,d=["_deleted"].concat(u),h=n.startKeys;h=[!1].concat(h);var p=te(e.schema,d,h,n.inclusiveStart),m=n.endKeys;m=[!1].concat(m);var v,y,b=ne(e.schema,d,m,n.inclusiveEnd),g=[],w=(await e.internals.state.creationPromise).transaction([s],"readonly",fe),_=w.objectStore(s);y=1===u.length&&u[0]===e.primaryPath?oe(e.internals,["_deleted",e.primaryPath]):oe(e.internals,d),v=_.index(y);var x=!1;if(await async function(e,t,n,r,o,i,s,a){var c=e.settings.IDBKeyRange?e.settings.IDBKeyRange:IDBKeyRange,u=e.internals.getIndexableStringByIndexId[s];if("function"==typeof n.getAll&&1!==r)for(var l,f=!0,d=!1,h=async function(){l&&(o=u(l.d));var e=c.bound(o,i,!f||!t.inclusiveStart,!t.inclusiveEnd);f=!1;var s=n.getAll(e,r);await new Promise(((e,t)=>{s.onerror=t,s.onsuccess=t=>{var n=t.target.result;l=A(n),0!==n.length&&!1===a(n.map((e=>e.d)))&&(d=!0),n.length<r&&(d=!0),e()}}))};!1===d;)await h();else{var p=c.bound(o,i,!t.inclusiveStart,!t.inclusiveEnd),m=n.openCursor(p);await new Promise((e=>{m.onsuccess=function(t){var n=t.target.result;if(n){var r=n.value;a([r.d])?n.continue():e()}else e()}}))}}(e,n,v,a,p,b,y,(e=>(e.forEach((e=>{x||c&&!c(e)||g.push(e),f||g.length!==i||(x=!0)})),!x))),w.commit&&w.commit(),f){var S=function(e,t){if(!t.sort)throw l("SNH",{query:t});var n=[];return t.sort.forEach((e=>{var t=Object.keys(e)[0],r=Object.values(e)[0];n.push({key:t,direction:r,getValueFn:O(t)})})),(e,t)=>{for(var r=0;r<n.length;++r){var o=n[r],i=o.getValueFn(e),s=o.getValueFn(t);if(i!==s)return"asc"===o.direction?Tn(i,s):Tn(s,i)}}}(e.schema,r);g=g.sort(S)}return{documents:g=g.slice(o,i)}}function Uo(e,t,n){for(var r=t.length,o=[],i=0;i<r;i++){var s=t[i];o.push(e.get(s))}var a={},c=E(A(o));return new Promise(((e,t)=>{c.onerror=t,c.onsuccess=()=>{for(var t=0;t<r;t++){var i=o[t].result;if(i){var s=i.i,c=i.d;c._deleted&&!n||(a[s]=c)}}e(a)}}))}var zo=d(),qo=function(){function e(e,t,n,r,o,i,s){this.changes$=new ct,this.instanceId=zo++,this.closed=!1,this.storage=e,this.databaseName=t,this.collectionName=n,this.schema=r,this.internals=o,this.options=i,this.settings=s,this.primaryPath=K(this.schema.primaryKey)}var t=e.prototype;return t.bulkWrite=async function(e,t){var n=this.internals.state;await n.creationPromise;var r={success:{},error:{}},o=await this.internals.state.creationPromise,i=[this.internals.storeNames.documentStore];this.schema.attachments&&i.push(this.internals.storeNames.attachmentsStore),Wo(this);var s,a=o.transaction(i,"readwrite",fe),c=a.objectStore(this.internals.storeNames.documentStore),u=e.map((e=>e.document[this.primaryPath])),l=await Uo(c,u,!0),f=P(this,this.primaryPath,l,e,t);r.error=f.errors;for(var d=f.bulkInsertDocs,h=0;h<d.length;++h){var p=d[h],m=p.document[this.primaryPath],v=se(this.internals,m,p.document);s=c.put(v),r.success[m]=p.document}for(var y=f.bulkUpdateDocs,b=0;b<y.length;++b){var g=y[b],w=g.document[this.primaryPath],_=se(this.internals,w,g.document);s=c.put(_),r.success[w]=g.document}if(this.schema.attachments){var x=a.objectStore(this.internals.storeNames.attachmentsStore);f.attachmentsAdd.forEach((e=>{s=x.put({docIdWithAttachmentId:me(e.documentId,e.attachmentId),length:e.attachmentData.length,type:e.attachmentData.type,data:e.attachmentData.data})})),f.attachmentsUpdate.forEach((e=>{s=x.put({docIdWithAttachmentId:me(e.documentId,e.attachmentId),length:e.attachmentData.length,type:e.attachmentData.type,data:e.attachmentData.data})})),f.attachmentsRemove.forEach((e=>{s=x.delete(me(e.documentId,e.attachmentId))}))}if(a.commit&&a.commit(),f.eventBulk.events.length>0){var S=E(f.newestRow).document;f.eventBulk.checkpoint={id:S[this.primaryPath],lwt:S._meta.lwt}}return new Promise(((e,t)=>{a.onerror=t;var n=()=>{f.eventBulk.events.length>0&&this.changes$.next(f.eventBulk),e(r)};s?s.onsuccess=n:a.oncomplete=n}))},t.findDocumentsById=function(e,t){return this.internals.state.creationPromise.then((n=>(Wo(this),Uo(n.transaction([this.internals.storeNames.documentStore],"readonly",fe).objectStore(this.internals.storeNames.documentStore),e,t))))},t.query=async function(e){return await this.internals.state.creationPromise,Wo(this),Fo(this,e)},t.count=async function(e){return e.queryPlan.selectorSatisfiedByIndex?async function(e,t){var n=t.queryPlan,r=e.internals.storeNames.documentStore,o=n.index,i=["_deleted"].concat(o),s=n.startKeys;s=[!1].concat(s);var a=te(e.schema,i,s,n.inclusiveStart),c=n.endKeys;c=[!1].concat(c);var u,l,f=ne(e.schema,i,c,n.inclusiveEnd),d=(await e.internals.state.creationPromise).transaction([r],"readonly",fe).objectStore(r);l=1===o.length&&o[0]===e.primaryPath?oe(e.internals,["_deleted",e.primaryPath]):oe(e.internals,i),u=d.index(l);var h=(e.settings.IDBKeyRange?e.settings.IDBKeyRange:IDBKeyRange).bound(a,f,!n.inclusiveStart,!n.inclusiveEnd),p=u.count(h);return{count:await new Promise(((e,t)=>{p.onsuccess=function(){e(p.result)},p.onerror=t})),mode:"fast"}}(this,e):{count:(await Fo(this,e)).documents.length,mode:"slow"}},t.getChangedDocumentsSince=async function(e,t){var n=this.internals.state;await n.creationPromise;var r=this.settings.IDBKeyRange,o=await this.internals.state.creationPromise;Wo(this);var i=o.transaction([this.internals.storeNames.documentStore],"readonly",fe),s=i.objectStore(this.internals.storeNames.documentStore),a=["_meta.lwt",this.primaryPath],c=oe(this.internals,a),u=s.index(c),l="";if(t){var f={[this.primaryPath]:t.id,_meta:{lwt:t.lwt}};l=(0,this.internals.getIndexableStringByIndexId[c])(f)}var d=r.lowerBound(l,!!t),h=await new Promise(((t,n)=>{var r=u.getAll(d,e);r.onerror=n,r.onsuccess=function(e){t(e.target.result)}}));i.commit&&i.commit();var p=A(h);return{documents:h.map((e=>e.d)),checkpoint:p?{id:p.d[this.primaryPath],lwt:p.d._meta.lwt}:t||{id:"",lwt:0}}},t.changeStream=function(){return this.changes$.asObservable()},t.cleanup=async function(e){var t=this.internals.state;await t.creationPromise;var n=this.settings.IDBKeyRange,r=await this.internals.state.creationPromise;Wo(this);var o=r.transaction([this.internals.storeNames.documentStore],"readwrite",fe),i=o.objectStore(this.internals.storeNames.documentStore),s=this.settings.batchSize,a=d()-e,c=oe(this.internals,ae),u=i.index(c),l=te(this.schema,ae,[!0,1],!0),f=ne(this.schema,ae,[!0,a],!0),h=n.bound(l,f,!0,!0),p=await new Promise(((e,t)=>{var n=u.getAll(h,s);n.onerror=t,n.onsuccess=function(t){e(t.target.result)}}));return await Promise.all(p.map((e=>new Promise(((t,n)=>{var r=e.i,o=i.delete(r);o.onerror=n,o.onsuccess=()=>t()}))))),o.commit&&o.commit(),p.length<s},t.remove=async function(){var e=this.internals.state;await e.creationPromise;var t=await this.internals.state.creationPromise;Wo(this);var n=t.transaction([this.internals.storeNames.documentStore],"readwrite",fe),r=n.objectStore(this.internals.storeNames.documentStore);return await Promise.all([r].map((e=>new Promise(((e,t)=>{var n=r.clear();n.onerror=t,n.onsuccess=t=>{e()}}))))),n.commit&&n.commit(),this.close()},t.getAttachmentData=async function(e,t){var n=this.internals.state;await n.creationPromise;var r=await this.internals.state.creationPromise;Wo(this);var o=r.transaction([this.internals.storeNames.attachmentsStore],"readonly",fe).objectStore(this.internals.storeNames.attachmentsStore),i=me(e,t);return new Promise(((n,r)=>{var s=o.get(i);s.onsuccess=()=>{var o=s.result;o?n(o.data):r("attachment missing documentId: "+e+" attachmentId: "+t)}}))},t.close=async function(){return await this.internals.state.creationPromise,Wo(this),this.closed=!0,this.changes$.complete(),async function(e){if(!e.closed&&(e.refCount=e.refCount-1,0===e.refCount))return e.closed=!0,e.storage.indexedDBStates.delete(e.name),e.creationPromise.then((e=>e.close()))}(this.internals.state)},t.conflictResultionTasks=function(){return(new ct).asObservable()},t.resolveConflictResultionTask=function(e){return H},e}();function Wo(e){if(e.closed)throw new Error("RxStorageInstanceIndexedDB is closed "+e.databaseName+"-"+e.collectionName)}var Qo=function(){function e(e){this.name=de,this.statics=he,this.indexedDBStates=new Map,this.settings=e}return e.prototype.createStorageInstance=function(e){return function(e){if(e.schema.keyCompression)throw l("UT5",{args:{params:e}});if((t=e.schema).encrypted&&t.encrypted.length>0||t.attachments&&t.attachments.encrypted)throw l("UT6",{args:{params:e}});var t;if(e.schema.attachments&&e.schema.attachments.compression)throw l("UT7",{args:{params:e}})}(e),async function(e,t,n){var r=ce(t.schema),o=Array.from(r.indexIdByName.values()),i=await ge(e,n,t.databaseName,[{collectionName:t.collectionName,schema:t.schema,indexIds:o}]);await i.creationPromise;var s={state:i,storeNames:we(t.collectionName,t.schema),getIndexableStringByIndexId:r.monadByIndexId,indexIdByName:r.indexIdByName,indexNames:Object.keys(r),indexIds:o},a=new qo(e,t.databaseName,t.collectionName,t.schema,s,t.options,n);return jn(de,t,a),a}(this,e,Object.assign({},this.settings,e.options))},e}();function Vo(e,t){return lt((function(n,r){var o=0;n.subscribe(dt(r,(function(n){return e.call(t,n,o++)&&r.next(n)})))}))}function Jo(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){if(e.constructor!==t.constructor)return!1;var n,r;if(Array.isArray(e)){if((n=e.length)!==t.length)return!1;for(r=n;0!=r--;)if(!Jo(e[r],t[r]))return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();var o=Object.keys(e);if((n=o.length)!==Object.keys(t).length)return!1;for(r=n;0!=r--;)if(!Object.prototype.hasOwnProperty.call(t,o[r]))return!1;for(r=n;0!=r--;){var i=o[r];if(!Jo(e[i],t[i]))return!1}return!0}return e!=e&&t!=t}function Go(e,t){return{connectionId:e.connectionId,answerTo:e.requestId,method:e.method,error:(n=t,{name:n.name,message:n.message,rxdb:n.rxdb,parameters:n.parameters,code:n.code,stack:n.stack?n.stack.replaceAll("\n"," \n "):void 0})};var n}function Ho(e,t){return{connectionId:e.connectionId,answerTo:e.requestId,method:e.method,return:t}}!function(e){var t;console.log("exposeWorkerRxStorage()");var n=new ct;if("undefined"!=typeof self&&"object"==typeof self.onconnect){var r=new Map;self.onconnect=e=>{var t=e.ports[0];t.onmessage=e=>{var o=e.data;if("create"===o.method){var i=I(o.params);i.multiInstance=!1,o.params=i}r.set(o.connectionId,t),n.next(o)}},t={storage:e.storage,messages$:n,send(e){Y(r,e.connectionId).postMessage(e)}}}else addEventListener("message",(e=>{var t=e.data;n.next(t)})),t={storage:e.storage,messages$:n,send(e){self.postMessage(e)}};!function(e){var t=new Map;function n(t){if(e.storage)return e.storage.createStorageInstance(t);if(e.database){var n=Array.from(e.database.storageInstances),r=t.collectionName,o=n.find((e=>e.collectionName===r));if(!o)throw console.dir(n),new Error("storageInstance does not exist "+JSON.stringify({collectionName:r}));var i=t.schema;if(!Jo(i,o.schema))throw new Error("Wrong schema "+JSON.stringify({schema:i,existingSchema:o.schema}));return Promise.resolve(o)}throw new Error("no base given")}e.messages$.pipe(Vo((e=>"custom"===e.method))).subscribe((async t=>{if(e.customRequestHandler)try{var n=await e.customRequestHandler(t.params);e.send(Ho(t,n))}catch(n){e.send(Go(t,n))}else e.send(Go(t,new Error("Remote storage: cannot resolve custom request because settings.customRequestHandler is not set")))})),e.messages$.pipe(Vo((e=>"create"===e.method))).subscribe((async r=>{var o=r.connectionId;if(!Array.isArray(r.params)){var i=r.params,s=i.collectionName,a=[i.databaseName,i.collectionName,i.schema.version].join("|"),c=t.get(a);if(c){if(!Jo(i.schema,c.params.schema))return void e.send(Go(r,new Error("Remote storage: schema not equal to existing storage")))}else try{c={storageInstancePromise:n(i),connectionIds:new Set,params:i},t.set(a,c)}catch(t){return void e.send(Go(r,t))}c.connectionIds.add(r.connectionId);var u=[],l=await c.storageInstancePromise;u.push(l.changeStream().subscribe((t=>{var n={connectionId:o,answerTo:"changestream",method:"changeStream",return:t};e.send(n)}))),u.push(l.conflictResultionTasks().subscribe((t=>{var n={connectionId:o,answerTo:"conflictResultionTasks",method:"conflictResultionTasks",return:t};e.send(n)})));var f=!1;if(e.database){var d=e.database,h=d.collections[s];h?h.onDestroy.push((()=>p())):d.onDestroy.push((()=>p()))}u.push(e.messages$.pipe(Vo((e=>e.connectionId===o))).subscribe((async t=>{var n,r=t;if("create"!==r.method&&"custom"!==r.method&&Array.isArray(r.params))try{if("close"===r.method&&e.database)return void e.send(Ho(r,null));if("close"===r.method&&E(c).connectionIds.size>1)return e.send(Ho(r,null)),E(c).connectionIds.delete(o),void u.forEach((e=>e.unsubscribe()));n=await l[r.method](r.params[0],r.params[1],r.params[2],r.params[3]),"close"!==r.method&&"remove"!==r.method||p(),e.send(Ho(r,n))}catch(t){e.send(Go(r,t))}}))),e.send(Ho(r,"ok"))}function p(){f||(f=!0,u.forEach((e=>e.unsubscribe())),E(c).connectionIds.delete(o),t.delete(a))}}))}(t)}({storage:function(e={}){var t=e.IDBKeyRange?e.IDBKeyRange:IDBKeyRange,n=e.indexedDB?e.indexedDB:indexedDB,r=Object.assign({batchSize:300,transactionDurability:"relaxed"},e,{IDBKeyRange:t,indexedDB:n});return new Qo(r)}({})})})();